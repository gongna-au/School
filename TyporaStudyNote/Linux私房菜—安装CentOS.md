# Linux私房菜—安装CentOS

### 3.1 本练习机的规划--尤其是分区参数

- Linux主机的角色定位： 本主机架设的主要目的在于练习Linux的相关技术
- 选择的distribution： 由于我们对于Linux的定位为“服务器”的角色，因此选择号称完全相容于商业版RHEL的社群版本， 就是CentOS 7.x
- 计算机系统硬件配备： 由于虚拟机越来越流行，因此鸟哥这里使用的是 Linux 原生的KVM 所搭建出来的虚拟硬件环境
- 虚拟机硬件配备如下：
  - CPU等级类别： 通过 Linux 原生的虚拟机管理员的处理，使用本机的 CPU 类型。本机 CPU 为 Intel i7 2600 这颗三、四年前很流行的 CPU 喔！ 至于芯片组则是KVM 自行设置的！
  - 内存： 通过虚拟化技术提供大约 1.2G 左右的内存
  - 硬盘： 使用一颗 40GB 的 VirtI/O 芯片组的磁盘，因此磁盘文件名应该会是 /dev/vda才对。同时提供一颗 2GB 左右的 IDE 界面的磁盘， 这颗磁盘仅是作为测试之用，并不安装系统！因此还有一颗 /dev/sda 才对喔！
  - 网卡： 使用 bridge （桥接） 的方式设置了对外网卡，网卡同样使用 VirtI/O 的芯片，还好 CentOS 本身就有提供驱动程序， 所以可以直接抓到网卡喔
  - 显卡（VGA）： 使用的是在 Linux 环境下运行还算顺畅的 QXL 显卡，给予 60M 左右的显示内存
  - 其他输入/输出设备： 还有仿真光驱、USB鼠标、USB键盘以及 17 英寸屏幕输出等设备喔！

- 磁盘分区的配置

  如果你的磁盘没有超过 2TB 的话，那么 Linux 默认是会以 MBR 模式来
  处理你的分区表的。由于我们仅切出 40GB 的磁盘来玩， 所以默认上会以 MBR 来配置！

  预计实际分区的情况如下：

  | 所需目录/设备 | 磁盘容量 | 文件系统 | 分区格式 |
  | ------------- | -------- | -------- | -------- |
  | BIOS boot     | 2MB      | 系统自订 | 主分区   |
  | /boot         | 1GB      | xfs      | 主分区   |
  | /             | 10GB     | xfs      | LVM 方式 |
  | /home         | 5GB      | xfs      | LVM 方式 |
  | swap          | 1GB      | swap     | LVM 方式 |

  由于使用 GPT 的关系，因此根本无须考虑主/延伸/逻辑分区的差异。不过，由于CentOS 默认还是会使用 LVM 的方式来管理你的文件系统， 而且我们后续的章节也会介绍如何管理这东西，因此，我们这次就使用 LVM 管理机制来安装系统看看！

- 开机管理程序（boot loader）：

  练习机的开机管理程序使用CentOS 7.x默认的grub2软件，并且安装到MBR上面。 也必须要安装到MBR上面才行！因为我们的硬盘是全部用在Linux上面的啊

- 检查表单： 最后，你可以使用下面的表格来检查一下，你要安装的数据与实际的硬件是否吻合.

### 3.2 开始安装CentOS 7

- 调整开机媒体（BIOS）：务必要使用CD或DVD光盘开机，通常需要调整BIOS；
- 选择安装模式与开机：包括图形接口/命令行等，也可加入特殊参数来开机进入安装画面
- . 选择语系数据：由于不同地区的键盘按键不同，此时需要调整语系/键盘/鼠标等配备；
- 软件选择：需要什么样的软件？全部安装还是默认安装即可？
- 磁盘分区：最重要的项目之一了！记得将刚刚的规划单拿出来设置；
-  开机管理程序、网络、时区设置与root密码：一些需要的系统基础设置！
- 安装后的首次设置：安装完毕后还有一些事项要处理，包括使用者、SELinux与防火墙等

#### 3.2.1).调整开机媒体（BIOS）与虚拟机创建流程

直接烧录到 U盘上面，然后在 **BIOS 里面调整成为可携式设备优先开机**的模式，这样就可以使用速度较快的 USB 开机来安装 Linux 了！

如果你已经有 Linux 的经验
与系统，那么可以使用底的方式来处理：

```
# 假设你的 USB 设备为 /dev/sdc ，而 ISO 文件名为 centos7.iso 的话：[root@study ~]# dd if=centos7.iso of=/dev/sdc
```

上面的过程会跑好长一段时间，时间的长短与你的 USB 速度有关！一般 USB2.0 的写入速度大约不到 10MB 左右，而 USB3.0 可能可以到 50MB 左右～ 因此会等待好几分钟的时间啦！写完之后，这颗 USB 就能够拿来作为开机与安装 Linux 之用了！

**Tips :**

**一般的主板环境中，使用 USB 2.0 的U盘设备并没有什么问题，他就是被判定为可携式设备。不过如果是 USB3.0 的设备，那主板可能会将该设备判断成为一颗磁盘！ 所以在BIOS 的设置中，你可能得要使用磁盘开机，并将这颗 USB “磁盘”指定为第一优先开机，这样才能够使用这颗 U盘来安装 Linux 喔！**

**如果你暂时找不到主板说明书，那也没关系！当你的计算机重新开机后，看到屏幕上面会有几个文字告诉你如何进入设置 （Setting） 模式中！ 一般常用的进入按钮大概都是“ Del ”按键，或者是“ F2 ”功能键，按下之后就可以看到 BIOS 的画面了！ 大概选择关键字为“ Boot ”的项目，就能够找到开机顺序的项目啰！**

**在调整完BIOS内的开机设备的顺序后，理论上你的主机已经可使用可开机光盘来开机了！ 如果发生一些错误讯息导致无法以CentOS 7.x DVD来开机，很可能是由于：1）计算机硬件不支持； 2）光驱会挑片； 3）光盘片有问题； 如果是这样，那么建议你再仔细的确认一下你的硬件是否有超频？或者其他不正常的现象。 另外，你的光盘来源也需要再次的确认！**

**在 Linux KVM 上面创建虚拟机的流程:**

- 首先，你得从“应用程序”里面的“系统工具”找到“虚拟机管理员”，点下他就会出现如下的图示
- 因为我们是想要创建新的虚拟机，因此你要像上图那样，点选“文件”然后点选“ New VirtualMachine ”，接下来就能够看到如下图的模样来创建新机器！

如上图所示，左图可以让你选择这个新的机器安装的时候，要安装的是哪个来源媒体，包括直接从网络来源安装、从硬盘安装等等。 我们当然是选择光盘镜像文件啰！按下一步就会进入选择光盘镜像文件的文件名～这时请按“浏览”并且选择“文件系统”，再慢慢一个一个选择即可！ 之后就继续下一步吧！

设置内存容量、CPU数量、磁盘容量等重要机器设置

#### 3.2.2). 选择安装模式与开机 - inst.gpt

光盘开机后安装画面之选择

你有 60 秒的时间可以选择不同的操作模式，从上而下分别是：

1. 正常安装 CentOS 7 的流程；
2. 测试此光盘后再进入 CentOS 7 的流程；
3. 进入除错模式！选择此模式会出现更多的选项，分别是：
   - 以基本图形接口安装 CentOS 7 （使用标准显卡来设置安装流程图示）；
   - 救援 CentOS 系统
   - 执行内存测试 （Run a memory test）
   - 由本机磁盘正常开机，不由光盘开机

基本上，除非你的硬件系统有问题，包括拥有比较特别的图形显卡等等，否则使用正常的CentOS 7 流程即可！ 那如果你怀疑这片光盘有问题，就可以选择测试光盘后再进入 CentOS7 安装的程序。如果你确信此光盘没问题，就不要测试了！ 不过如果你不在乎花费一、两分钟的时间去测试看看光盘片有没有问题，就使用测试后安装的流程啊！不过要进入安装程序前先等等， 先进行下面的流程再继续

**加入强制使用 GPT 分区表的安装参数**

如前所述，如果磁盘容量小于 2TB 的话，系统默认会使用 MBR 模式来安装！虚拟机仅有 40GB 的磁盘容量，所以默认肯定会用 MBR 模式来安装的啊！那如果想要强制使用GPT 分区表的话，你就得要这样做：

1. 使用方向键，将图 3.2.8 的光标移动到“ Install CentOS 7 ”的项目中
2. 按下键盘的 [Tab] 按钮，让光标跑到画面最下方等待输入额外的核心参数
3. 在出现的画面中，输入如下画面的数据
4. 其实重点就是输入“ inst.gpt ”这个关键字！输入之后系统会跑过一段侦测的画面， 这段侦测的流程依据你的光驱速度、硬件复杂度而有不同。反正，就是等待个几秒钟到一、两分钟就是了！画面如下所示：

进入安装流程的第一个画面就是选择你熟悉的语系啰！这个选择还挺重要的！因为未来默认的语系、默认用户选择的环境等， 都跟这里有关～当然未来是可以改变的～然后就可以按下“继续”来处理喔！

挑选准备要被安装的软件所在的媒体

因为我们是使用光盘开机，同时还没有设置网络，因此默认就会选择光盘片 （sr0 所在的设备）。如果你的主机系统当中还有其他安装程序认识的磁盘文件系统， 那么由于该磁盘也可能会放置镜像文件啊，所以该镜像文件也能够提供软件的安装，因此就有如同上图的“ISO文件”的选择项目。最后， 如果你的安装程序已经预先设置好网络了，那么就可以选择“在网络上”的项目，并且填写正确的网址 （URL） ， 那么安装程序就可以直接从网络上面下载安装了！

选择安装的软件数据为哪些

因为默认是“最小型安装”的模式，这种模式只安装最简单的功能，很适合高手慢慢搭建自己的环境之用。 但是我们是初学者啊～没有图形接口来看看实在有点怪！所以建议可以选择如下的项目

- 含有 GUI 的服务器 （GUI就是使用者图形接口啰！默认搭载 GNOME）
- GNOME 桌面环境： Linux 常见的图形接口
- KDE Plasma Workspaces：另一套常见的图形接口

#### 3.2.5). 磁盘分区与文件系统设置

#### 3.2.6). 核心管理与网络设置

#### 3.2.7).开始安装、设置 root 密码与新增可切换身份之一般用户

#### 3.2.8). 准备使用系统前的授权同意

- 安装笔记本电脑或其他类PC计算机的参数

  由于笔记本电脑加入了非常多的省电机制或者是其他硬件的管理机制，包括显卡常常是整合型的， 因此在笔记本电脑上面的硬件常常与一般桌面电脑不怎么相同。所以当你使用适合于一般桌面电脑的DVD来安装Linux时， 可能常常会出现一些问题，导致无法顺利的安装Linux到你的笔记本电脑中啊！那怎办？其实很简单，只要在安装的时候，告诉安装程序的linux核心不要载入一些特殊功能即可。 最常使用的方法就是，在使用DVD开机时，选择“”然后按下 [tab] 按键后，加入下面这些选项：

```
nofb apm=off acpi=off pci=noacpi
```

apm（Advanced Power Management）是早期的电源管理模块，acpi（Advanced Configuration and Power Interface）则是近期的电源管理模块。这两者都是硬件本身就有支持的，但是笔记本电脑可能不是使用这些机制， 因此，当安装时启动这些机制将会造成一些错误，导致无法顺利安装

nofb则是取消显卡上面的缓冲内存侦测。因为笔记本电脑的显卡常常是整合型的， Linux安装程序本身可能就不是很能够侦测到该显卡模块。此时加入nofb将可能使得你的安装过程顺利一些。

**对于这些在开机的时候所加入的参数，我们称为“核心参数”，这些核心参数是有意义的.**

### 3.3 多重开机安装流程与管理（Option）

#### 3.3.1). 安装 CentOS 7.x + windows 7 的规划

由于 Linux 对于 UEFI 的支持还有待持续进步，因此，下面是使用虚拟机创建 200GB 的磁盘， 然后使用传统 BIOS 搭配 MBR 分区表来实做多重开机的项目。预计创建 CentOS 7.x 以及一个 Windows 7 的多重操作系统，同时拥
有一个共享的数据磁盘.

因为“Windows 8.1 以前的版本，不能够在非 UEFI 的 BIOS 环境下使用 GPT 分区表的分区来开机. 我们既然没有UEFI 的环境，那自然就无法使用 GPT 分区来安装 Windows 系统了

#### 3.3.2). 进阶安装 CentOS 7.x 与 Windows 7

#### 3.3.3). 救援 MBR 内的开机管理程序与设置多重开机菜单

- 救援回 Linux 的开机管理程序：
- 修改开机菜单任务：
- 后续维护的注意事项

### 3.4 重点回顾

- 不论你要安装什么样的Linux操作系统角色，都应该要事先规划例如分区、开机管理程序等；
- 建议练习机安装时的磁盘分区能有/, /boot, /home, swap四个分区；
- 安装CentOS 7.x的模式至少有两种，分别是图形接口与命令行；
- CentOS 7 会主动依据你的磁盘容量判断要用 MBR 或 GPT 分区方式，你也可以强迫使用 GPT；
- 在安装的过程中，可以创建逻辑卷轴管理员 （LVM）；
- CentOS 7默认使用 xfs 作为文件系统
- 设置时不要选择启动kdump，因为那是给核心开发者查阅死机数据的；

### 3.5 本章习题

- Linux的目录配置以“树状目录”来配置，至于磁盘分区（partition）则需要与树状目合！ 请问，在默认的情况下，在安装的时候系统会要求你一定要分区出来的两个Partition为何？就是根目录“/”与内存交换空间“Swap”
- 软件磁盘阵列
- 的设备文件名为何？RAID : /dev/md[0-127];
- 如果我的磁盘分区时使用 MBR 方式，且设置了四个 Primary 分区，但是磁盘还有空间，请问我还能不能使用这些空间？不行！因为最多只有四个 Primary 的磁盘分区，没有多的可以进行分区了！且由于没有 Extended ，所以自然不能再使用 Logical 分区

