# Linux私房菜——Linux 的文件权限与目录配置

> Linux最优秀的地方之一就在于他的多用户多任务环境。而为了让各个使用者具有较保密的文件数据，因此文件的权限管理就变的很重要了。

**Linux一般将文件可存取的身份分为三个类别，分别是：owner/group/others**，并且这三个身份各有 `read/write/execute`的权限。

### 5.1 使用者与群组

1. 文件拥有者

   初次接触Linux的朋友大概会觉得很怪异，怎么“Linux有这么多使用者， 还分什么群组，有什么用？”。这个“使用者与群组”的功能可是相当健全而好用的一个安全防护。 **正是因为它的多用户多任务特性**。当多人来同时使用这个主机，每个用户的隐私与个人的工作环境就显得尤为重要。所以这个“文件的拥有者就显得非常重要了。”，当你把一个很隐私的文件放在自己的文件夹下面，你不希望有人也看见它吧。这个时候，你只需要把这个文件的拥有者，设置为自己，只允许自己可以查看与修改。即便别人可以看到你这个文件的名字，但是他们也不知道文件的内容。

2. 那么群组呢？为何要设置文件还有所属的群组

   群组就是团队在开发资源时，有两个团队，这两个团队之间有竞争关系，两个团队之间不能相互查看对方团队的内容，但是同一个团队要相互协作，团队内的成员可以对同一个项目进行修改。

   在Linux下面实现这个需求很简单，就是：**简易的文件权限设置，就能限制非自己团队（亦即是群组啰） 的其他人不能够阅览内容。**

   虽然两个团队之间不能相互查看，但是导师可以同时查看他们的内容，这个时候，导师不用创建两个账户，只要一个账户就可以，设置这个账户，使他同时支持两个群组，也就是说：“一个账户可以获得多个群组的支持。”

3. 使用者的意义：由于王家三人各自拥有自己的房间，所以， 王二毛虽然可以进入王三毛的房间，但是二毛不能翻三毛的抽屉喔！

4. 群组的概念：由于共同拥有客厅，所以王家三兄弟可以在客厅打开电视机啦、 翻阅报纸啦、坐在沙发上面发呆啦等等的！ 反正，只要是在客厅的玩意儿，三兄弟都可以使用喔！ 因为大家都是一家人嘛！

5. 这样说来应该有点晓得了喔！那个“王大毛家”就是所谓的“群组”啰， 至于三兄弟就是分别为三个“使用者”，而这三个使用者是在同一个群组里面的喔！ 而**三个使用者虽然在同一群组内，但是我们可以设置“权限”， 好让某些使用者个人的信息不被群组的拥有者查询**，以保有个人“私人的空间”啦！ 而设置群组共享，则可让大家共同分享喔！

6. 其他人的概念

   好了，那么今天又有个人，叫做张小猪，他是张小猪家的人，与王家没有关系啦！ 这个时候，除非王家认识张小猪，然后开门让张小猪进来王家，否则张小猪永远没有办法进入王家， 更不要说进到王三毛的房间啦！不过，如果张小猪通过关系认识了三毛，并且跟王三毛成为好朋友， 那么张小猪就可以通过三毛进入王家啦！呵呵！没错！那个张小
   猪就是所谓的“其他人，Others”啰！

**因此，我们就可以知道啦，在Linux里面，任何一个文件都具有“User, Group及Others”三种身份的个别权限。无论如何，“使用者身份”，与该使用者所支持的“群组”概念，在Linux的世界里面是相当的重要的， 他可以帮助你让你的多任务Linux环境变的更容易管理！更详细的 “身份与群组”设置，我们将在第十三章、帐号管理再进行解说。 下面我们将针对文件系统与文件权限来进行说明。**

- Linux 使用者身份与群组记录的文件

  在我们Linux系统当中，默认的情况下，所有的系统上的帐号与一般身份使用者，还有那个root的相关信息， 都是记录在`/etc/passwd`这个文件内的。至于个人的密码则是记录在`/etc/shadow`这个文件下，，Linux所有的群组名称都纪录在`/etc/group`内。

### 5.2 Linux 文件权限概念

#### 5.2.1 Linux文件属性

> 当你在你的屏幕前面出现了“Permission deny”的时
> 候，不要担心，“肯定是权限设置错误

-  ls ”这一个察看文件的指令

  使用 `sudo su` - 切换身份成为root后， 下达`ls -al`

```
总用量 276
drwxr-xr-x 35 gongna gongna  4096  8月 25 21:28 .
drwxr-xr-x  4 root   root    4096  7月 19 22:49 ..
drwxr-xr-x  2 gongna gongna  4096  4月 18 14:22 公共的
drwxr-xr-x  2 gongna gongna  4096  6月 13 10:40 模板
drwxr-xr-x  2 gongna gongna  4096  4月 21 21:46 视频
drwxr-xr-x  5 gongna gongna  4096  8月 12 12:04 图片
drwxr-xr-x  2 gongna gongna  4096  8月 16 14:01 文档
drwxr-xr-x  6 gongna gongna 12288  8月 16 13:57 下载
drwxrwxr-x  3 gongna gongna  4096  8月 20 10:36 学习笔记
drwxr-xr-x  2 gongna gongna  4096  8月 16 11:09 音乐
drwxr-xr-x  6 gongna gongna  4096  8月 16 14:03 桌面
-rw-------  1 gongna gongna 37070  8月 25 20:58 .bash_history
-rw-r--r--  1 gongna gongna   220  4月 18 14:09 .bash_logout
-rw-r--r--  1 gongna gongna  3827  5月 23 15:14 .bashrc
drwxrwxr-x 39 gongna gongna  4096  8月 15 23:36 .cache
drwx------ 31 gongna gongna  4096  8月 12 12:04 .config
drwx------  3 gongna gongna  4096  4月 18 20:29 .dbus
-rw-rw-r--  1 gongna gongna    49  4月 18 19:25 .gitconfig
drwx------  3 gongna gongna  4096  8月 22 20:14 .gnupg
drwxrwxr-x  5 gongna gongna  4096  8月  7 18:15 go
-rw-rw-r--  1 gongna gongna 25986  7月 15 16:30 index.html
drwxrwxr-x  3 gongna gongna  4096  7月 15 15:35 .java
-rw-------  1 gongna gongna    42  8月 25 11:58 .lesshst
drwxr-xr-x  6 gongna gongna  4096  4月 19 00:34 .local
drwxrwxr-x  3 gongna gongna  4096  7月 19 22:34 logs
drwxrwxr-x  3 gongna gongna  4096  8月  8 11:32 .m2
drwx------  5 gongna gongna  4096  4月 18 14:32 .mozilla
-rw-------  1 gongna gongna  2032  8月 25 10:55 .mysql_history
drwxrwxr-x  5 gongna gongna  4096  7月 20 22:31 .npm
-rw-------  1 gongna gongna    36  7月 20 21:55 .npmrc
drwxrwxr-x  2 gongna gongna  4096  8月  7 18:17 .oracle_jre_usage
-rw-rw-r--  1 gongna gongna   641  4月 26 19:29 packages.microsoft.gpg
drwx------  3 gongna gongna  4096  4月 18 14:59 .pki
drwx------  2 gongna gongna  4096  4月 18 20:29 .presage
-rw-r--r--  1 gongna gongna   834  5月  2 10:11 .profile
drwxr-xr-x  3 gongna gongna  4096 11月 15  2019 proxylab-handout
drwxrwxr-x  2 gongna gongna  4096  5月  2 09:59 .pylint.d
-rw-------  1 gongna gongna  3130  7月  6 21:32 .python_history
drwxr-xr-x  7 gongna gongna  4096  8月 16 11:29 snap
drwxrwxr-x  2 gongna gongna  4096  8月 26 11:40 .sogouinput
drwx------  2 gongna gongna  4096  8月  5 19:36 .ssh
-rw-r--r--  1 gongna gongna     0  4月 18 14:37 .sudo_as_admin_successful
drwxrwxr-x  2 gongna gongna  4096  4月 28 16:39 .vcpkg
-rw-------  1 gongna gongna  8538  7月 11 19:59 .viminfo
drwxrwxr-x  3 gongna gongna  4096  4月 18 14:59 .vscode
drwxrwxr-x  3 gongna gongna  4096  4月 26 19:34 .vscode-insiders
drwxrwxr-x  3 gongna gongna  4096  7月 20 21:42 VuepressBlogDemo
-rw-rw-r--  1 gongna gongna   303  7月 15 15:32 .wget-hsts
drwxrwxr-x  4 gongna gongna  4096  5月 21 21:47 .wine
-rwxr-xr-x  1 gongna root     445  6月 13 10:40 wps-office-prometheus.desktop
-rw-rw-r--  1 gongna gongna   132  4月 18 21:18 .xinputrc
[ 文件类型权限 ][连接数][文件拥有者][文件所属群组][文件大小][ 修改日期 ] [ 文件名 ]
```

**后续的`chgrp`, `chown`等指令可能都需要使用root的身份才能够处理.**

- **文件类型与权限**

  **其实共有十个字符，第一个字符：代表它是文件/目录/链接文件**

  - 当为[ d ]则是目录，例如上表文件名为`“.config”`的那一行；
  - 当为[ - ]则是文件，例如上表文件名为“`initial-setup-ks.cfg”`那一行；
  - 若是[ l ]则表示为链接文件（link file）；
  - 若是[ b ]则表示为设备文件里面的可供储存的周边设备（可随机存取设备）；
  - 若是[ c ]则表示为设备文件里面的序列埠设备，例如键盘、鼠标（一次性读取设备）

- **接下来的字符中，以三个为一组，且均为`“rwx”` 的三个参数的组合**，[ r]代表可读（read）、[ w ]代表可写（write）、[ x ]代表可执行（execute）。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号[ - ]而已。
  - 第一组为“文件拥有者可具备的权限”，以`“initial-setup-ks.cfg”`那个文件为例， 该文件的拥有者可以读写，但不可执行；
  - 第二组为“加入此群组之帐号的权限”；
  - 第三组为“非本人且没有加入本群组之其他帐号的权限”。

**特别注意喔！不论是那一组权限，基本上，都是“针对某些帐号来设计的权限。“也就是说：主角是账号(好比学生)，而不是社团”**

例题：若有一个文件的类型与权限数据为`“-rwxr-xr--”`，请说明其意义为何？

答：本例中为文件（-），拥有者的权限，本例中为可读、可写、可执行（`rwx`），：同群组使用者权限，本例中为可读可执行`（rx）`其他使用者权限，本例中为可读（r），就是只读之意。

**同时注意到，`rwx`所在的位置是不会改变的，有该权限就会显示字符，没有该权限就变成减号（-）就是了，另外，目录与文件的权限意义并不相同。这是因为目录与文件所记录的数据内容不相同所致。 **

- **第二栏表示有多少文件名链接到此节点（i-node）**

**每个文件的权限与属性是被记录在文件系统的一个节点，但是真正我们是通过目录树记录文件名来记录文件，所以目录树上的每个文件都会链接到一个文件系统的节点（这个链接到的节点可能相同也可能不同，有些文件名就会链接到同一个节点，这个节点通常是一个i-node号码），这个节点记录他们的属性。**

- 第三个是拥有者的账号。

- 第四个是这个文件所属的群组。

  在Linux下，一个账号可能加入多个群组。比如一个文件属于project这个群组，它具有权限：（`-rwxrwx--`，意味着这个群组内的其他账号对该文件也具有`-rwxrwx--`的权限。

  文件的三大权限：拥有者堆对这个文件的权限，同一个群组内账号对这个文件的权限，不在同一个群组内的账号对它的权限。

- 第五栏为这个文件的容量大小，默认单位为Bytes；

- 第六栏为这个文件的创建日期或者是最近的修改日期

- 第七栏为这个文件的文件名

  这个字段就是文件名了。比较特殊的是：如果文件名之前多一个“ . ”，则代表这个文件为“隐藏文件”，例如上表中的`.config`那一行，该文件就是隐藏文件。 你可以使用“ls”及“ls -a”这两个指令去感受一下什么是隐藏文件。

- 例题：假设`test1, test2, test3`同属于`testgroup`这个群组，如果有下面的两个文件，请说明两个文件的拥有者与其相关的权限为何？

```
-rw-r--r-- 1 root root 238 Jun 18 17:22 test.txt
-rwxr-xr-- 1 test1 testgroup 5238 Jun 19 10:25 ping_tsai
```

答：文件`test.txt`的拥有者为root，所属群组为root。至于权限方面则只有root这个帐号可以存取此文件，其他人则仅能读此文件；

另一个文件`ping_tsai`的拥有者为`test1`，而所属群组为`testgroup`。其中：

- `test1` 可以针对此文件具有可读可写可执行的权力；
- 而同群组的`test2, test3`两个人与`test1`同样是`testgroup`的群组帐号，则仅可读可执行但不能写（亦即不能修改）；
- 至于没有加入`testgroup`这一个群组的其他人则仅可以读，不能写也不能执行！

例题：承上一题如果我的目录为下面的样式，请问`testgroup`这个群组的成员与其他人others是否可以进入本目录？

```
rwxr-xr-- 1 test1 testgroup 5238 Jun 19 10:25 groups/
```

**文件拥有者`test1[rwx]`可以在本目录中进行任何工作；而`testgroup`这个群组[r-x]的帐号，例如`test2`, `test3`亦可以进入本目录进行工作，但是不能在本目录下进行写入的动作；至于other的权限中[r--]虽然有r ，但是由于没有x的权限，因此others的使用者，并不能进入此目录！**也就是说r与x都有才能进如某个目录，只有r是进入不了目录的。

- Linux文件权限的重要性

  与Windows系统不一样的是，在Linux系统当中，每一个文件都多加了很多的属性进来，尤其是群组的概念，这样有什么用途呢？ 其实，最大的用途是在“数据安全性”上面的。

  - 系统保护的功能： 举个简单的例子，在你的系统中，关于系统服务的文件通常只有root才能读写或者是执行，例如/etc/shadow这一个帐号管理的文件，由于该文件记录了你系统中所有帐号的数据， 因此是很重要的一个配置文件，当然不能让任何人读取（否则密码会被窃取啊），只有root才能够来读取啰！所以该文件的权限就会成为[ ---------- ]啰！咦！所有人都不能使用？没关系，root基本上是不受系统的权限所限制的， 所以无论文件权限为何，默认root都可以存取喔！ **当你看到一个文件的权限是[---------],只有root可以读取，执行，写入。默认的root是不受文件权限的限制的。**
  - 团队开发软件或数据共享的功能： 此外，如果你有一个软件开发团队，在你的团队中，你希望每个人都可以使用某一些目录下的文件， 而非你的团队的其他人则不予以开放呢？以上面的例子来说，`testgroup`的团队共有三个人，分别是`test1`, `test2,` `test3，`那么我就可以将团队所需的文件权限订为[ `-rwxrws---` ]来提供给`testgroup`的工作团队使用啰！（怎么会有 s 呢？没关系，这个我们在后续章节再讲给你听！）
  - 未将权限设置妥当的危害： 再举个例子来说，如果你的目录权限没有作好的话，可能造成其他人都可以在你的系统上面乱搞啰！ 例如本来只有root才能做的开关机、`ADSL`的拨接程序、新增或删除使用者等等的指令，若被你改成任何人都可以执行的话， 那么如果
    使用者不小心给你重新开机啦！重新拨接啦！等等的！那么你的系统不就会常常莫名其妙的挂掉啰！ 而且万一你的使用者的密码被其他不明人士取得的话，只要他登陆你的系统就可以轻而易举的执行一些root的工作！

#### 5.2.2 如何改变文件属性与权限

- 如何修改一个文件的属性与权限呢？
- 一个文件的哪些权限我们可以修改？（一个文件的属性与权限有很多）
  - `chgrp`:改变文件所属的群组
  - `chown`:改变文件的所有者
  - `chmod`:改变文件的权限，`SUID` `SGID` `SBIT`等等的特性

- `chgrp`改变文件所属的群组

  **注意：要被改变的群组名称必须要在etc/group文件内。否则就会报错。**改变文件的群组要切换到root用户。

  假设你已经切换到了root用户，在你的主文件夹内有一个名为 initial-`setup-ks.cfg` 的文件，如何将该文件的群组改变一下呢？假设你已经知道在/etc/group里面已经存在一个名为users的群组， 但是testing这个群组名字就不存在/etc/group当中了，此时改变群组成为users与
  testing分别会有什么现象发生呢？

  ```
  # chgrp [-R] dirname/filename ...
  -R : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件、目录
  都更新成为这个群组之意。常常用在变更某一目录内所有的文件之情况。
  
  # chgrp users initial-setup-ks.cfg
  # ls -l
  -rw-r--r--. 1 root users 1864 May 4 18:01 initial-setup-ks.cfg
  # chgrp testing initial-setup-ks.cfg
  chgrp: invalid group: `testing'
  找不到这个群组名
  ```

- 改变文件拥有者 `chown`

  **要改变的拥有者必须在这个`/etc/passwd`下存在。**

```
chown的用途还满多的，他还可以顺便直接修改群组的名称呢！此外，如果要连目录下的所有次目录或文件同时更改文件拥有者的话，直接加上 -R 的选项即可！
# chown [-R] 帐号名称 文件或目录
# chown [-R] 帐号名称:群组名称 文件或目录文件或目录
选项与参数：
-R : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件都变更
范例：将 initial-setup-ks.cfg 的拥有者改为bin这个帐号
#  chown bin initial-setup-ks.cfg
# ls -al
-rw-r--r--. 1 bin users 1864 May 4 18:01 initial-setup-ks.cfg
范例：将 initial-setup-ks.cfg 的拥有者与群组改回为root
#  chown root:root initial-setup-ks.cfg
           |    |
		拥有者  群组   
		
		要想改一个就写一个，改两个就写两个。
		
# ls -l
-rw-r--r--1 root root 1864 May 4 18:01 initial-setup-ks.cfg
```

**总结：事实上，`chown`也可以使用“`chown user.group file`”，亦即在拥有者与群组间加上小数点“ . ”也行！ 不过很多朋友设置帐号时，喜欢在帐号当中加入小数点（例如`vbird.tsai`这样的帐号格式），这就会造成系统的误判，`chown`也能单纯的修改所属群组呢！ 例如“`chown .sshd initial-setup-ks.cfg”`就是修改群组～看到了吗？就是那个小数点的用途！**

- 么什么时候要使用`chown`或`chgrp`呢？

  答：最常见的例子就是在复制文件给你之外的其他人时， 我们使用最简单的`cp`指令来说明

  ```
  # cp 来源文件 目的文件
  
  假设你今天要将.bashrc这个文件拷贝成为.bashrc_test文件名，且是要给bin这个人，你可以
  这样做：
  # cp .bashrc .bashrc_test
  # ls -al .bashrc*
  -rw-r--r--. 1 root root 176 Dec 29 2013 .bashrc
  -rw-r--r--. 1 root root 176 Jun 3 00:04 .bashrc_test
  
  ```

  **由于复制行为（`cp`）会复制执行者的属性与权限，**`.bashrc_test还是属于root`所拥有， 如此一来，即使你将文件拿给bin这个使用者了，那他仍然无法修改的（看属性/权限就知道了吧）， 所以你就必须要将这个文件的拥有者与群组修改一下啰！知道如何修改了吧？

- 改变权限, `chmod`

  文件权限的改变使用的是 `chmod`这个指令，但是，权限的设置方法有两种， 分别可以使用数字或者是符号来进行权限的变更。

  - 数字类型改变文件的权限

    Linux文件的基本权限就有九个，分别是owner/group/others 三种身份的read/write/execute权限，各权限的分数对照表如下：

    ```
    > r:4 > w:2 > x:1
    ```

    每种身份（owner/group/others）各自的三个权限（r/w/x）分数是需要累加的，例如当权限为： `[-rwxrwx---]` 分数则是：

    > owner = `rwx` = 4+2+1 = 7 > group = `rwx` = 4+2+1 = 7 > others= --- = 0+0+0 = 0

    所以等一下我们设置权限的变更时，该文件的权限数字就是770啦！变更权限的指令`chmod`的语法是这样的：

    ```
    # chmod [-R] xyz 文件或目录
    选项与参数：
    xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加
    -R : 进行递回（recursive）的持续变更，亦即连同次目录下的所有文件都会变更
    ```

    举例来说，如果要将`.bashrc`这个文件所有的权限都设置启用，那么就下达：

    ```
    # ls -al .bashrc
    -rw-r--r--. 1 root root 176 Dec 29 2013 .bashrc
    # chmod 777 .bashrc
    # ls -al .bashrc
    -rwxrwxrwx. 1 root root 176 Dec 29 2013 .bashrc
    举例：那如果要将权限变成“ -rwxr-xr-- ”呢？
    chmod 754 .bashrc
    ```

    **注意：我们在用Vim编辑完一个shell的文字批处理文件之后，它的权限通常是：664**。这个文件对于拥有者通常是不可执行的，而且对于其他用户只有读的权限。如果要把这个文件变成可执行的文件，并且让其他用户可以修改此文件。那么需要下达：755的指令。

    另外，如果有些文件你不希望被其他人看到，那么应该将文件的权限设置为例如：`“-rwxr-----”`，那就下达“ `chmod 740` filename ”吧！

  - 符号类型改变文件权限

    还有一个改变权限的方法呦！从之前的介绍中我们可以发现，基本上就九个权限分别是
    （1）user （2）group （3）others三种身份啦！那么我们就可以借由u, g, o来代表三种身份的权限！此外， a 则代表 all 亦即全部的身份。读写以及执行的权限就可以写成r, w, x

    ```
    chmod | u g o a | +（加入） -（除去） =（设置） | r w x | 文件或目录 |
    举例：
    “设置”一个文件的权限成为“-rwxr-xr-x”时，基本上就是：
    chmod u=rwx,g=rx .bashrc
    # 个 u=rwx,go=rx 是连在一起的，中间并没有任何空白字符！
    # ls -al .bashrc
    -rwxr-xr-x. 1 root root 176 Dec 29 2013 .bashrc
    假如是“ -rwxr-xr-- ”这样的权限呢？
    chmod u=rwx,g=rx,o=r 
    假如我不知道原来的属性，我只是需要给某个文件增加写的权限，那么我只需要：
    # chmod a+w  .bashrc
    # chmod u+x  .bashrc
    
    ```

    而如果是要将权限去掉而不更动其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：s

    ```
    # chomd a-x .bashrc
    # ls -al .bashrc
    rw-rw-rw-. 1 root root 176 Dec 29 2013 .bashrc
    ```

    + 与 – 的状态下，只要是没有指定到的项目，则该权
      限“不会被变动”

#### 5.2.3 目录与文件之权限意义：

- 文件权限对于一般文件与目录文件有何不同呢?

  答：**有很大很大的不同。**

文件是实际含有数据的地方，包括一般文本文件、数据库内容档、二进制可可执行文件（binary program）等等。 因此，权限对于文件来说，他的意义是这样的：

- r （read）：可读取此一文件的实际内容，如读取文本文件的文字内容等；
- w （write）：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
- x （execute）：该文件具有可以被系统执行的权限.

那个可读（r）代表读取文件内容,但是对于（x）呢？因为在Windows下面一个文件是否具有执行的能力是借由“ 扩展名 ”来判断的， 例如：`.exe,`
`.bat,` `.com` 等等，但是在Linux下面，我们的文件是否能被执行，则是借由是否具有“x”这个权限来决定的！跟文件名是没有绝对的关系的！个w这个权限，以具有写入/编辑/新增/修改文件的内容的权限， 但并不具备有删除该文件本身的权限！ **所以说：对于文件的`rwx`来说， 主要都是针对“文件的内容”而言，与文件文件名的存在与否没有关系！因为文件记录的是实际的数据嘛！**

- 权限对目录的重要性

  > 文件是存放实际数据的所在，那么目录主要是在记录文件名清单,文件名与目录有强烈的关连啦！如果是针对目录时，那个 r, w, x 对目录是什么意义呢？

  - r （read contents in directory）：

    表示具有读取目录结构清单的权限，**所以当你具有读取（r）一个目录的权限时，表示你可以查询该目录下的文件名数据。 所以你就可以利用 ls 这个指令将该目录的内容列表显示出来**

  - w （modify contents of directory）：

    **可写入的权限对目录来说，是很了不起的** **表示你具有异动该目录结构清单的权限，也就是下面这些权限：**

    - 创建新的文件与目录
    - 删除已经存在的文件与目录（不论该文件的权限为何！）
    - 将已存在的文件或目录进行更名；
    - 搬移该目录内的文件、目录位置。 总之，目录的w权限就与该目录下面的文件名异动有关就对了啦

  - x （access directory）:

    咦！目录的执行权限有啥用途啊？目录只是记录文件名而已，总不能拿来执行吧？**没错！目录不可以被执行**,但是x代表的是使用者能否进入该目录成为工作目录！所谓的工作目录（work directory）就是你目前所在的目录啦！

> 设“文件是一堆文件数据夹”，所以你可能可以在上面写/改一些数据。而“目录是一堆抽屉”.

| 元件 | 内容       | 叠代物品   | r            | w            | x                |
| ---- | ---------- | ---------- | ------------ | ------------ | ---------------- |
| 文件 | 详细的数据 | 文件数据夹 | 读到文件内部 | 修改文件内容 | 执行文件内容     |
| 目录 | 文件名     | 可分类抽屉 | 读到文件名   | 修改文件名   | 进入该目录的权限 |

对一般文件来说，`rwx` 主要是针对“文件的内容”来设计权限，对目录来说，`rwx`则是针对“目录内的文件名列表”来设计权限。 其中最有趣的大概就属目录的x 权限了！“文件名怎么执行”？没道理嘛！其实，这个 x 权限设计，就相当于“该目录，也就是该抽屉的 "钥匙" ”啦！ 没有钥匙你怎么能够打开抽屉呢？对吧！

```
有个目录的权限如下所示：
drwxr--r-- 3 root root 4096 Jun 25 08:35 .ssh
```

系统有个帐号名称为`vbird`，这个帐号并没有支持root群组，请问`vbird`对这个目录有何权限？是否可切换到此目录中？

答：`vbird`对此目录仅具有r的权限，因此`vbird`可以查询此目录下的文
件名列表，因为`vbird`不具有x的权限，亦即 `vbird` 没有这个抽屉的钥匙啦！ 因此`vbird`并不能切换到此目录内！（相当重要的概念！）

**能不能进入某一个目录，只与该目录的x权限有关，而与r无关，r 只能读到透明抽屉里的文件名列表。工作目录对于指令的执行是非常重要的，如果你在某目录下不具有x的权限， 那么你就无法切换到该目录下，也就无法执行该目录下的任何指令，即使你具有该目录的r或w的权限。**

> 很多朋友在架设网站的时候都会卡在一些权限的设置上，他们开放目录数据给网际网络的任何人来浏览， 却只开放r的权限，那样的结果就是导致网站服务器软件无法到该目录下读取文件（最多只能看到文件名）， 最终用户总是无法正确的查阅到文件的内容（显示权限不足啊！）要注意：要开放目录给任何人浏览时，应该至少也要给予r及x
> 的权限，但w权限不可随便给！ 为什么w不能随便给，我们来看下一个例子：
>
> ```
> 例题：假设有个帐号名称为dmtsai，他的主文件夹在/home/dmtsai/，dmtsai对此目录具有[rwx]的权限。 若在此目录下有个名为the_root.data的文件，该文件的权限如下：
> 
> -rwx------ 1 root root 4365 Sep 19 23:20 the_root.data
> 由于dmtsai对此文件来说是“others”的身份，因此这个文件他无法读、无法编辑也无法执行， 也就是说，他无法变动这个文件的内容就是了。
> 但是由于这个文件在他的主文件夹下， 他在此目录下具有rwx的完整权限，因此对于the_root.data这个“文件名”来说，他是能够“删除”的！ 结论就是，dmtsai这个用户能够删除the_root.data这个文件！ |
> ```
>
> 假设有个莫名其妙的人，拿着一个完全密封的数据夹放到你的办公室抽屉中，因为完全密封你也打不开、看不到这个数据夹的内部数据（对文件来说，你没有权限）。 但是因为这个数据夹是放在你的抽屉中，你当然可以拿出/放入任何数据在这个抽屉中（对目录来说，你具有所有权限）。 所以，情况就是：你打开抽屉、拿出这个没办法看到的数据夹、将他丢到走廊上的垃圾桶！搞定了 （顺利删除！）！

我们用root的身份在所有人都可以工作的`/tmp`目录中创建一个名为testing的目录， 该目录的权限为744且目录拥有者为root。另外，在testing目录下在创建一个空的文件， 文件名亦为testing。创建目录可用`mkdir`（make directory），创建空文件可用touch（下一章会说明）来处理。 所以过程如下所示：

```
#  cd /tmp
#  mkdir testing
#  chmod 744 testing
#  touch testing/testing
#  chmod 600 testing/testing
#  ls -ald testing testing/testing
drwxr--r--. 2 root root 20 Jun 3 01:00 testing
-rw-------. 1 root root 0 Jun 3 01:00 testing/testing
仔细看一下，目录的权限是 744 ，且所属群组与使用者均是 root 喔！
# 那么在这样的情况下面，一般身份使用者对这个目录/文件的权限为何？

```

一般用户应该能有 r 的权限

```
$ cd /tmp
$ ls -l testing/
ls: cannot access testing/testing: Permission denied
total 0
?????????? ? ? ? ? ? testing
# 虽然有告知权限不足，但因为具有 r 的权限可以查询文件名。由于权限不足（没有x），所以会有一堆问号
$  cd testing/
-bash: cd: testing/: Permission denied
# 因为不具有 x ，所以当然没有进入的权限啦！有没有呼应前面的权限说明啊！
```

```
如果该目录属于用户本身，会有什么状况？
# 1\. 先用 root 的身份来搞定 /tmp/testing 的属性、权限设置：
[root@study tmp]# chown dmtsai /tmp/testing
[root@study tmp]# ls -ld /tmp/testing
drwxr--r--. 2 dmtsai root 20 6月 3 01:00 /tmp/testing # dmtsai 是具有全部权限的！
# 2\. 再用 dmtsai 的帐号来处理一下 /tmp/testing/testing 这个文件看看：
[dmtsai@study tmp]$ cd /tmp/testing
[dmtsai@study testing]$ ls -l &lt;==确实是可以进入目录
-rw-------. 1 root root 0 Jun 3 01:00 testing &lt;==文件不是vbird的！
[dmtsai@study testing]$ rm testing &lt;==尝试杀掉这个文件看看！
rm: remove write-protected regular empty file `testing'? y
# 竟然可以删除！
```

- 使用者操作功能与权限

  **假设**两个文件名，分别是下面这样：

  - `/dir1/file1`

  - `/dir2`

    假设你现在在系统使用 `dmtsai` 这个帐号，那么这个帐号针对 `/dir1`, `/dir1/file1`, `/dir2` 这三个文件名来说，分别需要“哪些最小的权限”才能达成各项任务？

    答：

    | `/dir1` | 操作动作                     | `/dir/file1` | `/dir2` | 重点                                        |
    | ------- | ---------------------------- | ------------ | ------- | ------------------------------------------- |
    | x       | 读取 `file1` 内容            | r            | -       | 要能够进`/dir1` 才能读到里面的文件数据！    |
    | x       | 修改 `file1`内容             | `rw`         | -       | 能够进入 `/dir1` 且修改`file1` 才行！       |
    | x       | 执行 `file1`内容             | `rx`         | -       | 能够进入 `/dir1` 且 `file1` 能运行才行！    |
    | `wx`    | 删除 `file1`内容             | -            | -       | 能够进入 `/dir1` 具有目录修改的权限即可！   |
    | x       | 将`file1`的内容复制到`/dir2` | r            | `wx`    | 要能够读 `file1` 且能够修改`/dir2` 内的数据 |

    

**修改文件内容，执行文件内容，不仅仅是w与x,本质上修改与执行都先要读取文件的内容。**

**同理对目录的操作，不仅仅是w修改目录的数据，首先要进入。**

**文件的修改代表的是对文件内部数据的改变，比如文件里面的数据多了或者少了，但是对于目录的修改代表的是：目录内部数据（文件/目录）多了或者少了。**

**对于目录而言，进入是很重要的，而读取就显得没有那么重要，这是因为:对于一个抽屉而言，r就相当于是抽屉里面的灯光，有了r你也仅仅只是可以看到抽屉里的其他东西，当然，就算没有r，你摸黑也是可以拿到你想要的那个文件夹，但是同时没有r也就意味着，你使用tab键是无法补全的，因为你是在摸黑，你不知道其他的夹子长什么样。**

**Tips** ：看了上面这个表格，你应该会觉得很可怕喔！因为，要读一个文件时，你得要具有“这个文件所在目录的 x 权限”才行！所以，通常要开放的目录， 至少会具备 `rx` 这两个权限！现在你知道为啥了吧？

#### 5.2.4 Linux文件种类与扩展名

> 任何设备在Linux下面都是文件， 不仅如此，连数据沟通的接口也有专属的文件在负责。

**Linux的文件种类真的很多～ 除了前面提到的一般文件（-）与目录文件（d）之外，还有哪些种类的文件呢？**

我们在刚刚提到使用“ls -l”观察到第一栏那十个字符中，第一个字符为文件的类型。 除了常见的一般文件（-）与目录文件（d）之外，还有哪些种类的文件类型呢？

- 正规文件：

  正规文件（regular file ）： 就是一般我们在进行存取的类型的文件，在由 `ls -al` 所显示出来的属性方面，第一个字符为 [ - ]，例如 `[-rwxrwxrwx ]`。另外，依照文件的内容，又大略可以分为：

  - 纯文本文件（ASCII）：这是Linux系统中最多的一种文件类型啰， 称为纯文本文件。是因为内容为我们人类可以直接读到的数据，例如数字、字母等等。 几乎只要我们可以用来做为设置的文件都属于这一种文件类型。 举例来说，你可以下达“ `cat~/.bashrc` ”就可以看到该文件的内容。 （cat 是将一个文件内容读出来的指令）
  - 二进制档（binary）：还记得我们在“ 第零章、计算机概论 ”里面的软件程序的运行中提过， 我们的**系统其实仅认识且可以执行二进制文件（binary file）**你的Linux当中的可可执行文件（scripts, 文字体批处理文件不算）举例来说，刚刚下达的指令cat就是一个binary file。
  - 数据格式文件（data）： 有些程序在运行的过程当中会读取某些特定格式的文件，那些特定格式的文件可以被称为数据文件 （data file）。举例来说，我们的Linux在使用者登陆时，都会将登录的数据记录在 `/var/log/wtmp`那个文件内，该文件是一个data file，他能够通过last这个指令读出来！ 但是使用cat时，会读出乱码,因为他是属于一种特殊格式的文件。

**正规文件：分为纯文本文件，可以用cat读取。二进制可执行文件，binary。数据格式文件，不能用cat读取出来。**

- 目录（directory）：

  第一个属性为 [ d ]，例如 `[drwxrwxrwx]。`

- 链接文件：

  第一个属性为 [ l ]（英文L的小写），例如 `[lrwxrwxrwx]` ；

- 设备与设备文件（device）： 与系统周边及储存等相关的一些文件， 通常都集中在`/dev`这个目录之下！通常又分为两种：

  - 区块（block）设备文件 ：就是一些储存数据， 以提供系统随机存取的周边设备，举例来说，硬盘与软盘等就是啦！ 你可以随机的在硬盘的不同区块读写，这种设备就是区块设备啰！你可以自行查一下`/dev/sda`看看， 会发现第一个属性为[ b ]喔！
  - 字符（character）设备文件：亦即是一些序列埠的周边设备， 例如键盘、鼠标等等！这些设备的特色就是“一次性读取”的，不能够截断输出。 举例来说，你不可能让鼠标“跳到”另一个画面，而是“连续性滑动”到另一个地方啊！第一个属性为 [ c ]。

- 数据接口文件（sockets）： 既然被称为数据接口文件， 想当然尔，这种类型的文件通常被用在网络上的数据承接了。我们可以启动一个程序来监听用户端的要求， 而用户端就可以通过这个socket来进行数据的沟通了。第一个属性为 [ s ]， 最常在/run或`/tmp`这些个目录中看到这种文件类型了。
- 数据输送档（FIFO, pipe）： FIFO也是一种特殊的文件类型，他主要的目的在解决多个程序同时存取一个文件所造成的错误问题。 FIFO是first-in-first-out的缩写。第一个属性为[p]

**除了设备文件是我们系统中很重要的文件，最好不要随意修改.另一个比较有趣的文件就是链接文件。如果你常常将应用程序捉到桌面来的话，你就应该知道在 Windows下面有所谓的“捷径”。同样的，你可以将 `linux`下的链接文件简单的视为一个文件或目录的捷径.至于socket与FIFO文件比较难理解，因为这两个咚咚与程序（process）比较有关系**

- Linux文件扩展名：

  **基本上，Linux的文件是没有所谓的“扩展名”的**，我们刚刚就谈过，**一个Linux文件能不能被执行，与他的第一栏的十个属性有关**与文件名根本一点关系也没有.

**具有“可执行的权限”以及“具有可执行的程序码”是两回事！也就是说：在 Linux 下面，你可以让一个文本文件，例如我们之前写的 `text.txt` 具有“可执行的权限” （加入 x 权限即可）， 但是这个文件明显的无法执行，（给予可执行权限以后，能不能被执行还要看是否内容里是否有可以被执行 的数据。没有可执行的数据就没有可执行的程序码。能不能被执行成功还要看具体的内容。）因为他不具备可执行的程序码！**

**具有可执行权限与具有可执行程序码不一样，可以被执行跟可以执行成功又是不一样的。**虽然如此，不过我们仍然希望可以借由扩展名来了解该文件是什么东西，所以， 通常我们还是会以适当的扩展名来表示该文件是什么种类的。下面有数种常用的扩展名：

- *.sh ： 脚本或批处理文件 （scripts），因为批处理文件是使用shell写成的，所以扩展名就编成 .sh 啰；
- Z, .tar, `.tar.gz`, .zip, `*.tgz`：经过打包的压缩文件。这是因为压缩软件分别为 `gunzip, tar`等等的，由于不同的压缩软件，而取其相关的扩展名啰
- `.html, .php`：网页相关文件，分别代表 HTML 语法与 `PHP` 语法的网页文件。`.html` 的文件可使用网页浏览器来直接打开，至于 `.php` 的文件， 则可以通过 client 端的浏览器来server 端浏览，以得到运算后的网页结果呢！

基本上，Linux系统上的文件名真的只是让你了解该文件可能的用途而已， 真正的执行与否仍然需要权限的规范才行！例如虽然有一个文件为可可执行文件， 如常见的/bin/ls这个显示文件属性的指令，不过，如果这个文件的权限被修改成无法执行时， 那么ls就变成不能执行啰！

上述的这种问题最常发生在文件传送的过程中。例如你在网络上下载一个可可执行文件，但是偏偏在你的 Linux系统中就是无法执行！那么就是可能文件的属性被改变了！不要怀疑，**从网络上传送到你的 Linux系统中，文件的属性与权限确实是会被改变的**！

- Linux文件长度限制[1]：

  在Linux下面，使用传统的`Ext2/Ext3/Ext4`文件系统以及近来被 `CentOS` 7 当作默认文件系统的`xfs` 

  针对文件的文件名长度限制为：

  - 单一文件或目录的最大容许文件名为 `255Bytes`，以一个 ASCII 英文占用一个 Bytes 来说，则大约可达 255 个字符长度。若是以每个中文字占用 `2Bytes` 来说， 最大文件名就是大约在 128 个中文字之谱！

    是相当长的文件名喔！我们希望Linux的文件名称可以一看就知道该文件在干嘛的， 所以文件名通常是很长很长！而用惯了Windows的人可能会受不了，因为文件名称通常真的都很长。

    ```
    ? ; & ! [ ] | \ （ ） { } .
    ```

    因为这些符号在命令行下，是有特殊意义的！另外，文件名称的开头为小数点“.”时， 代表这个文件为“隐藏文件”喔！同时，由于指令下达当中，常常会使用到 -option 之类的选项， 所以你最好也避免将文件文件名的开头以 - 或 + 来命名啊！

  - Linux文件名称的限制：

    由于Linux在命令行下的一些指令操作关系，一般来说，你在设置Linux下面的文件名称时，最好可以避免一些特殊字符比较好

  文件系统：`EXT4`、`Btrfs` 和 `XFS`是什么？

  答：文件系统主要用于控制所有程序在不使用数据时如何存储数据、如何访问数据以及有什么其它信息（元数据）和数据本身相关。`XFS`文件系统是`RHEL7`系列的默认文件系统，目的是为了替代传统的`EXT4`文件系统。文件系统可以按两种逻辑分类：

  - ```
    第一种分类是分为可被远程访问的和只能私有访问的
    ```

  - ```undefined
    第二种分类是分为可读写文件和只能只读静态文件
    ```

Linux系统有一个名叫[FHS（Filesystem Hierarchy Standard）](https://link.segmentfault.com/?url=http%3A%2F%2Frefspecs.linuxfoundation.org%2FFHS_3.0%2Ffhs-3.0.pdf)的目录层级结构标准，尽管`linux`系统有多种发行版，但都按照标准的结构划分文件系统，对开发，应用和使用来说形成默认的规范。/boot 目录存放了启动系统所需的静态文件。`/dev` 目录包含了系统上的挂载设备和内核产生的虚拟设备（设备或是块设备分为两种，一种是静态设备一种是映射设备，静态设备用`/dev/sdx`或`/dev/disk`表示传统存储卷，映射设备。/etc 目录一般包含配置文件而不应包含二进制可执行文件，二进制文件应该放到`/usr/bin`或`/usr/sbin`目录中，`/etc/sysconfig`目录存放了许多系统boot启动时运行的脚本。`/mnt` 目录一般用作挂载点，可以挂载临时文件系统。/opt目录存放系统中非默认的软件以及第三方包。`/proc`目录存放特殊文件从内核获取的信息以及向内核传递信息。

**`XFS`文件系统**

`XFS`是一个高度可扩展的高性能文件系统，它支持元数据日志有助于快速恢复，支持在挂载和活动状态下在线碎片整理和扩容。`RHEL7`默认支持了备份恢复工具的`XFS`选项。`XFS`支持多种数据分配方案，其中延迟分配方案允许写入`XFS`文件系统的数据在调用`fsync()`之前不会真正写入磁盘。`XFS`还支持了新的`DAX（Direct Access）技术`，可以使应用程序直接映射内存到磁盘地址上。

### 5.3 Linux目录配置

-  为什么每套Linux distributions他们的配置文件啊、可执行文件啊、每个目录内放置的咚咚啊，其实都差不多？ 原来是有一套标准依据.

#### 5.3.1 Linux目录配置的依据--`FHS`

因为利用Linux来开发产品或distributions的社群/公司与个人实在太多了，如果每个人都用自己的想法来配置文件放置的目录，那么将可能造成很多管理上的困扰。 你能想像，你进入一个企业之后，所接触到的Linux目录配置方法竟然跟你以前学的完全不同吗？很难想像吧～所以，后来就有所谓的`Filesystem Hierarchy Standard （FHS）`标准的出炉了！

根据`FHS[2]`的标准文件指出，他们的主要目的是希望让使用者可以了解到已安装软件通常放置于那个目录下， 所以他们希望独立的软件开发商、操作系统制作者、以及想要维护系统的使用者，都能够遵循`FHS`的标准。 也就是说，`FHS`的重点在于规范每个特定的目录下应该要放置什么样子的数据而已 这样做好处非常多，因为Linux操作系统就能够在既有的面貌下,（目录架构不变）发展出开发者想要的独特风格。

> `FHS`就是用来规范特定的目录下应该发放置什么样的数据。

`FHS`根据过去的经验一直再持续的改版的，`FHS`依据文件系统使用的频繁与否与是否允许使用者随意更动， 而将目录定义成为四种交互作用的形态：

|                      | 可分享的（shareable）        | 不可分享的（`unshareable`） |
| -------------------- | ---------------------------- | --------------------------- |
| 不变的（static）     | `/usr （`软件放置处）        | `/etc` （配置文件）         |
|                      | /opt （第三方协力软件）      | /boot （开机与核心档）      |
| 可变动的（variable） | /var/mail （使用者邮件信箱） | /var/run （程序相关）       |
|                      | /var/spool/news （新闻群组） | /var/lock （程序相关）      |

**可分享的：**可以分享给其他系统挂载使用的目录，所以包括可执行文件与使用者的邮件等数据， 是能够分享给网络上其他主机挂载用的目录。

**不可分享的：自己机器上面运行的设备文件或者是与程序有关的socket文件等， 由于仅与自身机器有关，所以当然就不适合分享给其他主机了**

**不变的：有些数据是不会经常变动的，跟随着distribution而不变动。 例如函数库、文件说明文档、系统管理员所管理的主机服务配置文件等等**

**可变动的：经常改变的数据，例如登录文件、一般用户可自行收受的新闻群组等。**

事实上，`FHS`针对目录树架构仅定义出三层目录下面应该放置什么数据而已，分别是下面这三个目录的定义：

- / （root 根目录）：与开机系统有关；
- `/usr` （`unix software resource`）：与软件安装/执行有关；
- `/var` （variable）：与系统运行过程有关

**Tips** 这个 root 在 Linux 里面的意义真的很多很多,多到让人搞不懂那是啥玩意儿。 如果以“帐号”的角度来看，所谓的 root 指的是“系统管理员！”的身份， 如果以“目录”的角度来看，所谓的 root 意即指的是根目录，就是 /

- 根目录 （/） 的意义与内容：

  根目录是整个系统最重要的一个目录，因为不但所有的目录都是由根目录衍生出来的，同时根目录也与开机/还原/系统修复等动作有关。 由于系统开机时需要特定的开机软件、核心文件、开机所需程序、函数库等等文件数据，若系统出现错误时，根目录也必须要包含有能够修复文件系统的程序才行。 因为根目录是这么的重要，所以在`FHS`的要求方面，他希望根目录不要放在非常大的分区内， 因为越大的分区你会放入越多的数据，如此一来根目录所在分区就可能会有较多发生错误的机会。

  因此`FHS`标准建议：根目录（/）所在分区应该越小越好， 且**应用程序所安装的软件最好不要与根目录放在同一个分区内**，保持根目录越小越好。 如此不但性能较佳，根目录所在的文件系统也较不容易发生问题。

  此`FHS`定义出根目录（/）下面应该要有下面这些次目录的存在才好，
  即使没有实体目录，`FHS`也希望至少有链接文件存在才好：

  | 目录                                | 应放置文件内容                                               |
  | ----------------------------------- | ------------------------------------------------------------ |
  | 第一部分 `FHS`要求必须要存在的目录  |                                                              |
  | `/bin`                              | 系统有很多放置可执行文件的目录，但/bin比较特殊。因为/bin放置的是在:单人维护模式下还能够被操作的指令。 在/bin下面的指令可以被root与一般帐号所使用，主要有：cat, `chmod`, `chown`, date, `mv,` `mkdir,` `cp,` bash等等常用的指令 |
  | `/boot`                             | 这个目录主要在放置开机会使用到的文件，包括Linux核心文件以及开机菜单与开机所需配置文件等等。 Linux kernel常用的文件名为：`vmlinuz`，如果使用的是`grub2`这个开机管理程序， 则还会存在`/boot/grub2/`这个目录喔！ |
  | `/dev`                              | 在Linux系统上，任何设备与周边设备都是以文件的型态存在于这个目录当中的。 你只要通过存取这个目录下面的某个文件，就等于存取某个设备～ 比要重要的文件有`/dev/null`, `/dev/zero`, `/dev/tty`, `/dev/loop`, `/dev/sd`等等 |
  | `/etc`                              | 系统主要的配置文件几乎都放置在这个目录内，例如人员的帐号密码档、各种服务的启始档.一般来说，这个目录下的各文件属性是可以让一般使用者查阅的， 但是只有root有权力修改.`FHS`建议不要放置可可执行文（binary）在这个目录中喔。比较重要的文件有：`/etc/modprobe.d`/`/etc/passwd`, `/etc/fstab`, `/etc/issue` 等等。另外 `FHS` 还规范几个重要的目录最好要存在 /etc/ 目录下喔：`/etc/opt`（必要）这个目录在放置第三方协力软件 /opt 的相关配置文件 `/etc/X11/`（建议）：与 X Window 有关的各种配置文件都在这里，尤其是 `xorg.conf` 这个 X Server 的配置文件。 `/etc/sgml`（建议）：与 `SGML` 格式有关的各项配置文件 `/etc/xml/`（建议）：与 XML格式有关的各项配置文件 |
  | `/lib`                              | 系统的函数库非常的多，而/lib放置的则是在开机时会用到的函数库，以及在`/bin或/sbin`下面的指令会调用的函数库而已。什么是函数库呢？你可以将他想成是“外挂”，某些指令必须要有这些“外挂”才能够顺利完成程序的执行之意。 另外 `FSH` 还要求下面的目录必须要存在：/lib/modules/：这个目录主要放置可抽换式的核心相关模块（驱动程序）喔！ |
  | `/media`                            | **media是“媒体”的英文，顾名思义，这个/media下面放置的就是可移除的设备啦！ 包括软盘、光盘、`DVD`等等设备都暂时挂载于此。常见的文件名有：`/media/floppy, /media/cdrom`等等** |
  | `/mnt`                              | 如果你想要暂时挂载某些额外的设备，一般建议你可以放置到这个目录中。在古早时候，这个目录的用途与/media相同啦！只是有了/media之后，这个目录就用来暂时挂载用了 |
  | `/opt`                              | 这个是给第三方协力软件放置的目录。什么是第三方协力软件啊？ 举例来说，KDE这个桌面管理系统是一个独立的计划，不过他可以安装到Linux系统中，因此KDE的软件就建议放置到此目录下了。 另外，如果你想要自行安装额外的软件（非原本的distribution提供的），那么也能够将你的软件安装到这里来。 不过，以前的Linux系统中，我们还是习惯放置在`/usr/local`目录下 |
  | `/run`                              | 早期的 `FHS` 规定系统开机后所产生的各项信息应该要放置到 /var/run 目录下，新版的 `FHS` 则规范到 /run 下面。 由于 /run 可以使用内存来仿真，因此性能上会好很多 |
  |                                     | Linux有非常多指令是用来设置系统环境的，这些指令只有root才能够利用来“设置”系统，其他使用者最多只能用来“查询”而已。 放在`/sbin`下面的为开机过程中所需要的，里面包括了开机、修复、还原系统所需要的指令。 至配置 于某些服务器软件程序，一般则放置到`/usr/sbin/`当中。至于本机自行安装软件所产生的系统可执行文件（system binary）， 则放置到`/usr/local/sb`当中了。常见的指令包括：`fdisk`, f`sck`, `ifconfig,` `mkfs`等等。 |
  | `/srv`                              | `srv`可以视为“service”的缩写，是一些网络服务启动之后，这些服务所需要取用的数据目录。 常见的服务例如WWW, FTP等等。举例来说，WWW服务器需要的网页数据就可以放置在`/srv/www/`里面。 不过，系统的服务数据如果尚未要提供给网际网络任何人浏览的话，默认还是建议放置到 /var/lib下面即可 |
  | `/tmp`                              | 这是让一般使用者或者是正在执行的程序暂时放置文件的地方。 这个目录。是任何人都能够存取的，所以你需要定期的清理一下。当然，重要数据不可放置在此目录啊！ 因为`FHS`甚至建议在开机时，应该要将`/tmp`下的数据都删除 |
  | `/usr`                              | 第二层 `FHS` 设置，后续介绍                                  |
  | `/var`                              | 第二层 `FHS` 设置，主要为放置变动性的数据，后续介绍          |
  | 第二部分份：`FHS`建议可以存在的目录 |                                                              |
  | `/home`                             | 这是系统默认的使用者主文件夹（home directory）。在你新增一个一般使用者帐号时， 默认的使用者主文件夹都会规范到这里来。比较重要的是，主文件夹有两种代号喔：~：代表目前这个使用者的主文件夹 |
  | `/lib<qual>`                        | 用来存放与 /lib 不同的格式的二进制函数库，例如支持 64 位的 `/lib64` 函数库等 |
  | `/root`                             | 系统管理员（root）的主文件夹。之所以放在这里，是因为如果进入单人维护模式而仅挂载根目录时， 该目录就能够拥有root的主文件夹，所以我们会 希望root的主文件夹与根目录放置在同一个分区中。 |
  |                                     | 事实上`FHS`针对根目录所定义的标准就仅有上面的咚咚，不过我们的Linux下面还有许多目录你也需要了解一下的。 下面是几个在Linux当中也是非常重要的目录 |

  | 目录          | 应放置内容                                                   |
  | ------------- | ------------------------------------------------------------ |
  | `/lost+found` | 这个目录是使用标准的`ext2/ext3/ext4`文件系统格式才会产生的一个目录，目的在于当文件系统发生错误时， 将一些遗失的片段放置到这个目录下。不过如果使用的是 `xfs` 文件系统的话，就不会存在这个目录了！ |
  | `/proc`       | `这个目录本身是一个“虚拟文件系统（virtual filesystem）”喔！他放置的数据都是在内存当中， 例如系统核心、行程信息（process）、周边设备的状态及网络状态等等。因为这个目录下的数据都是在内存当中， 所以本身不占任何硬盘空间啊！比较重要的文件例如：/proc/cpuinfo, /proc/dma,/proc/interrupts, /proc/ioports`, `/proc/net/*` 等等。 |
  | `/sys`        | 这个目录其实跟`/proc`非常类似，也是一个虚拟的文件系统，主要也是记录核心与系统硬件信息较相关的信息。 包括目前已载入的核心模块与核心侦测到的硬件设备信息等等。这个目录同样不占硬盘容量喔！ |

  

早期 Linux 在设计的时候，若发生问题时，救援模式通常仅挂载根目录而已，因此有五个重要的目录被要求一定要与根目录放置在一起， 那就是 `/etc, /bin, /dev, /lib,/sbin` 这五个重要目
录。现在许多的 Linux distributions 由于已经将许多非必要的文件移出 `/usr` 之外了， 所以`/usr` 也是越来越精简，同时因为 `/usr` 被建议为“即使挂载成为只读，系统还是可以正常运行”的模样，所以救援模式也能同时挂载 `/usr` 喔！ 例如我们的这个 `CentOS 7.x` 版本在救援模式的情况下就是这样。因此那个五大目录的限制已经被打破了呦！例如 `CentOS 7.x` 就已经将`/sbin, /bin, /lib` 通通移动到 `/usr` 下面了哩！

- **`/usr` 的意义与内容：**

依据`FHS`的基本定义，`/usr`里面放置的数据属于可分享的与不可变动的（shareable,static）， 如果你知道如何通过网络进行分区的挂载（例如在服务器篇会谈到的NFS服务器），那么`/usr`确实可以分享给区域网络内的其他主机来使用喔！

很多读者都会误会`/usr`为user的缩写，其实`usr`是Unix Software Resource的缩写， 也就是“Unix操作系统软件资源”所放置的目录。，而不是使用者的数据啦

因为是所有系统默认的软件（distribution发布者提供的软件）都会放置到`/usr`下面，因此这个目录有点类似Windows 系统的“C:\Windows\ （当中的一部份） + C:\Program files\”这两个目录的综合体，系统刚安装完毕时，这个目录会占用最多的硬盘容量。一般来说，`/usr`的次目录建议有下面这些：

| 目录                                 | 应放置文件的内容                                             |
| ------------------------------------ | ------------------------------------------------------------ |
| 第一部份：`FHS` 要求必须要存在的目录 |                                                              |
| `/usr/bin/`                          | 所有一般用户能够使用的指令都放在这里！目前新的 `CentOS` 7 已经将全部的使用者指令放置于此，而使用链接文件的方式将 /bin 链接至此！也就是说， `/usr/bin` 与 /bin 是一模一样了！另外，`FHS` 要求在此目录下不应该有子目录！ |
| `/usr/lib/`                          | 基本上，与 /lib 功能相同，所以 /lib 就是链接到此目录中的！   |
| `/usr/local/`                        | 系统管理员在本机自行安装自己下载的软件（非distribution默认提供者），建议安装到此目录， 这样会比较便于管理。举例来说，你的distribution提供的软件较旧，你想安装较新的软件但又不想移除旧版此时你可以将新版软件安装于`/usr/local/`目录下，可与原先的旧版软件有分别啦！ 你可以自行到`/usr/local`去看看，该目录下也是具有`bin, etc,include, lib...`的次目录喔！ |
| `/usr/sbin/`                         | 非系统正常运行所需要的系统指令。最常见的就是某些网络服务器软件的服务指令（daemon）啰！不过基本功能与 `/sbin` 也差不多， 因此目前 `/sbin` 就是链接到此目录中的。 |
| `/usr/share/`                        | 主要放置只读架构的数据文件，当然也包括共享文件。在这个目录下放置的数据几乎是不分硬件架构均可读取的数据， 因为几乎都是文字文件嘛！在此目录下常见的还有这些次目录：`/usr/share/man`：线上说明文档 `/usr/share/doc：`软件杂项的文件说明 `/usr/share/zoneinfo`：与时区有关的时区文件 |
| 第二部份：`FHS` 建议可以存在的目录   |                                                              |
| `/usr/games/`                        | 与游戏比较相关的数据放置处                                   |
| `/usr/include/`                      | c/c++等程序语言的文件开始（header）与包含档（include）放置处，当我们以`tarball`方式 （`*.tar.gz` 的方式安装软件）安装某些数据时，会使用到里头的许多包含档喔！ |
| `/usr/libexec/`                      | 某些不被一般使用者惯用的可执行文件或脚本（script）等等，都会放置在此目录中。例如大部分的 X 窗口下面的操作指令， 很多都是放在此目录下的。 |
| `/usr/lib<qual>/`                    | 与 /lib<qual>/功能相同，因此目前 /lib<qual> 就是链接到此目录中 |
| `/usr/src/`                          | 一般源代码建议放置到这里，`src`有source的意思。至于核心源代码则建议放置到`/usr/src/linux/`目录下。 |

- /var 的意义与内容：

  如果`/usr`是安装时会占用较大硬盘容量的目录，那么/var就是在系统运行后才会渐渐占用硬盘容量的目录。 因为/var目录主要针对常态性变动的文件，包括高速缓存（cache）、登录文件（log file）以及某些软件运行所产生的文件， 包括程序文件（lock file, run file），或者例如
  `MySQL`数据库的文件等等。常见的次目录有：

  

| 目录                              | 应该放置的文件的内容                                         |
| --------------------------------- | ------------------------------------------------------------ |
| 第一部分：`FHS`要求必须存在的目录 |                                                              |
| `/var/cache/`                     | 应用程序本身运行过程中会产生的一些暂存盘；                   |
| `/var/lib/`                       | 程序本身执行的过程中，需要使用到的数据文件放置的目录。在此目录下各自的软件应该要有各自的目录。 举例来说，`MySQL`的数据库放`/var/lib/mysql/`而rpm的数据库则放到/var/lib/rpm去！ |
| `/var/lock/`                      | 某些设备或者是文件资源一次只能被一个应用程序所使用，如果同时有两个程序使用该设备时， 就可能产生一些错误的状况，因此就得要将该设备上锁（lock），以确保该设备只会给单一软件所使用。 举例来说，烧录机正在烧录一块光盘，你想一下，会不会有两个人同时在使用一个烧录机烧片？ 如果两个人同时烧录，那片子写入的是谁的数据？所以当第一个人在烧录时该烧录机就会被上锁， 第二个人就得要该设备被解除锁定（就是前一个人用完了）才能够继续使用啰。目前此目录也已经挪到 /run/lock 中！ |
| `/var/log/`                       | 重要到不行！这是登录文件放置的目录！里面比较重要的文件如`/var/log/messages, /var/log/wtmp（`记录登陆者的信息）等。 |
| `/var/mail/`                      | 放置个人电子邮件信箱的目录，不过这个目录也被放置到/var/spool/mail/目录中！ 通常这两个目录是互为链接文件啦！ |
| `/var/run/`                       | 某些程序或者是服务启动后，会将他们的PID放置在这个目录下喔！至于`PID`的意义我们会在后续章节提到的。 与 /run 相同，这个目录链接到 /run去了！ |
| `/var/spool/`                     | 这个目录通常放置一些伫列数据，所谓的“伫列”就是排队等待其他程序使用的数据啦！ 这些数据被使用后通常都会被删除。举例来说，系统收到新信会放到/var/spool/mail/中， 但使用者收下该信件后该封信原则上就会被删除。信件如果暂时寄不出去会被放到`/var/spool/mqueue/`中， 等到被送出后就被删除。如果是工作调度数据（`crontab`），就会被放置到`/var/spool/cron/`目录中！ |

- 针对`FHS`，各家distributions的异同，与 `CentOS7` 的变化

由于`FHS`仅是定义出最上层（/）及次层（`/usr, /var`）的目录内容应该要放置的文件或目录数据， 因此，在其他次目录层级内，就可以随开发者自行来配置了。举例来说，`CentOS`的网络设置数据放在这个目录下面`/etc/sysconfig/network-scripts/` 目录下，但是`SuSE`则是将网络放置在`/etc/sysconfig/network/` 目录下，目录名称可是不同的呢！不过只要记住大致的`FHS`标准，差异性其实有限啦！

此外，`CentOS 7` 在目录的编排上与过去的版本不同喔！本节稍早之前已经有介绍过，这里做个汇整。 比较大的差异在于将许多原本应该要在根目录 （/） 里面的目录，将他内部数据全部挪到 `/usr` 里面去，然后进行链接设置！包括下面这些

`/bin --> /usr/bin`

`/sbin --> /usr/sbin`

`/lib --> /usr/lib/lib64 --> /usr`

`/lib64`

`/var/lock --> /run/lock`

`/var/run --> /run`

#### 5.3.2 目录树（directory tree）

另外，在Linux下面，所有的文件与目录都是由根目录开始的！那是所有目录 与文件的源头然后再一个一个的分支下来，有点像是树枝状啊～因此，我们也称这种目录配置方式为：“目录树（directory tree）” 这个目录树有什么特性呢？他主要的特性有：

- 目录树的启始点为根目录 （/, root）
- **每一个目录不止能使用本地端的 partition 的文件系统，也可以使用网络上的 `filesystem`举例来说， 可以利用 Network File System （NFS） 服务器挂载某特定目录等。**
- 每一个文件在此目录树中的文件名（包含完整路径）都是独一无二的。

好，谈完了`FHS`的标准之后，实际来看看`CentOS`在根目录下面会有什么样子的数据吧！我们可以下达以下的指令来查询

```
[dmtsai@study ~]$ ls -l /
lrwxrwxrwx. 1 root root 7 May 4 17:51 bin -&gt; usr/bin
dr-xr-xr-x. 4 root root 4096 May 4 17:59 boot
drwxr-xr-x. 20 root root 3260 Jun 2 19:27 dev
drwxr-xr-x. 131 root root 8192 Jun 2 23:51 etc
drwxr-xr-x. 3 root root 19 May 4 17:56 home
lrwxrwxrwx. 1 root root 7 May 4 17:51 lib -&gt; usr/lib
lrwxrwxrwx. 1 root root 9 May 4 17:51 lib64 -&gt; usr/lib64
drwxr-xr-x. 2 root root 6 Jun 10 2014 media
drwxr-xr-x. 2 root root 6 Jun 10 2014 mnt
drwxr-xr-x. 3 root root 15 May 4 17:54 opt
dr-xr-xr-x. 154 root root 0 Jun 2 11:27 proc
dr-xr-x---. 5 root root 4096 Jun 3 00:04 root
drwxr-xr-x. 33 root root 960 Jun 2 19:27 run
lrwxrwxrwx. 1 root root 8 May 4 17:51 sbin -&gt; usr/sbin
drwxr-xr-x. 2 root root 6 Jun 10 2014 srv
dr-xr-xr-x. 13 root root 0 Jun 2 19:27 sys
drwxrwxrwt. 12 root root 4096 Jun 3 19:48 tmp
drwxr-xr-x. 13 root root 4096 May 4 17:51 usr
drwxr-xr-x. 22 root root 4096 Jun 2 19:27 var


```

<img src="/home/gongna/图片/2021-08-27_16-53.png" style="zoom:200%;" />

#### 5.3.3 绝对路径与相对路径

除了需要特别注意的`FHS`目录配置外，在文件名部分我们也要特别注意喔！因为根据文件名写法的不同，也可将所谓的路径（path）定义为绝对路径（absolute）与相对路径（relative）。 这两种文件名/路径的写法依据是这样的：

- 绝对路径：由根目录（/）开始写起的文件名或目录名称， 例如 `/home/dmtsai/.bashrc；`
- 相对路径：相对于目前路径的文件名写法。 例如 `./home/dmtsai` 或 `../../home/dmtsai/` 等等。反正开头不是 / 就属于相对路径的写法

而你必须要了解，相对路径是以“你当前所在路径的相对位置”来表示的。举例来说，你目前在/home 这个目录下， 如果想要进入 /var/log 这个目录时，可以怎么写呢？
1. `cd /var/log （absolute）`
2. `cd ../var/log （relative）`

因为你在 /home 下面，所以要回到上一层 （../） 之后，才能继续往 /var 来移动的！ 特别注意这两个特殊的目录：
**. ：代表当前的目录，也可以使用 ./ 来表示；**
**.. ：代表上一层目录，也可以 ../ 来代表。**

例题：网络文件常常提到类似`“./run.sh”`之类的数据，这个指令的意义为何？答：由于指令的执行需要变量（bash章节才会提到）的支持，若你的可执行文件放置在本目录，并且本目录并非正规的可执行文件目录（`/bin, /usr/bin`等为正规），此时要执行指令就得要严格指定该可执行文件。“./”代表“本目录”的意思，所以`“./run.sh”`代表“执行本目录下， 名为`run.sh`的文件”啰！

#### 5.3.4 `CentOS` 的观察

如同在第一章谈到的 Linux distribution 的差异性， 除了 `FHS` 之外，还有个 Linux Standard Base `（LSB）` 的标准是可以依循的！我们可以简单的使用 ls 来查看 `FHS` 规范的目录是否正确的存在于你的 Linux 系统中， 那么 Linux 核心、`LSB` 的标准又该如何查阅呢？基本上，`LSB` 团队是有列出正确支持 `LSB` 标准的 distribution 在如下的网页中：

### 5.4 重点回顾

- Linux的每个文件中，可分别给予使用者、群组与其他人三种身份个别的 `rwx` 权限；
- 群组最有用的功能之一，就是当你在团队开发资源的时候，且每个帐号都可以有多个群组的支持
- 利用ls -l显示的文件属性中，第一个字段是文件的权限，共有十个位，第一个位是文件类型， 接下来三个为一组共三组，为使用者、群组、其他人的权限，权限有r,w,x三种；
- 如果文件名之前多一个“ . ”，则代表这个文件为“隐藏文件”；
- 若需要root的权限时，可以使用 `su -` 这个指令来切换身份。处理完毕则使用 exit 离开 `su`的指令环境
- 更改文件的群组支持可用`chgrp`，修改文件的拥有者可用`chown`，修改文件的权限可用`chmod`
- `chmod`修改权限的方法有两种，分别是符号法与数字法，数字法中r,w,x分数为4,2,1；
- 对文件来讲，权限的性能为：
  r：可读取此一文件的实际内容，如读取文本文件的文字内容等；
  w：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）；
  x：该文件具有可以被系统执行的权限
- 对目录来说，权限的性能为：
  r （read contents in directory）
  w （modify contents of directory）
  x （access directory）
- 要开放目录给任何人浏览时，应该至少也要给予r及x的权限，但w权限不可随便给；
- 能否读取到某个文件内容，跟该文件所在的目录权限也有关系 （目录至少需要有 x 的权限）
- Linux文件名的限制为：单一文件或目录的最大容许文件名为 255 个英文字符或 128 个中文字符；
- 根据`FHS`的官方文件指出， 他们的主要目的是希望让使用者可以了解到已安装软件通常放置于那个目录下
- `FHS`订定出来的四种目录特色为：`shareable, unshareable, static, variable`等四类；
- `FHS`所定义的三层主目录为：`/, /var, /usr`三层而已；
- 绝对路径文件名为从根目录 / 开始写起，否则都是相对路径的文件名

### 5.5 本章练习

- 早期的 Unix 系统文件名最多允许 14 个字符，而新的 Unix 与 Linux 系统中，文件名最多可以容许几个字符？

  由于使用`Ext2/Ext3/Ext4/xfs` 文件系统，单一文件名可达 255 字符

- 当一个一般文件权限为 `-rwxrwxrwx` 则表示这个文件的意义为？

  答：任何人皆可读取、修改或编辑、可以执行，但不一定能删除

- 我需要将一个文件的权限改为 `-rwxr-xr--` 请问该如何下达指令？

  答：`chmod 754 filename` 或`chmod u=rwx,g=rx,o=r filename`

- 若我需要更改一个文件的拥有者与群组，该用什么指令？

  答:`chown, chgrp`

- 请问下面的目录与主要放置什么数据： `/etc/, /boot, /usr/bin, /bin, /usr/sbin, /sbin, /dev, /var/log, /run`

  答：`/etc/：` **几乎所有系统的配置文件：`shadow` `passwd`**

  ​	`boot：` **系统的开机文件。**

  ​	`usr/bin/  /bin :` **可执行文件存放的地方**

  ​	`dev:` **系统设备文件的目录**

  ​	`/var/log:` **系统登录文件的地方**

  ​	`/run:` 将经常变动的项目（每次开机都不同，如程序的`PID）`
  移动到内存暂存，所以 /run 并不占实际磁盘容量

- 若一个文件的文件名开头为“ . ”，例如 `.bashrc` 这个文件，代表什么？另外，如何显示出这个文件名与他的相关属性？有“ . ”为开头的为隐藏文件，需要使用 `ls -a 这个 -a` 的选项才能显示出隐藏文件的内容，而使用 `ls -al` 才能显示出属性。