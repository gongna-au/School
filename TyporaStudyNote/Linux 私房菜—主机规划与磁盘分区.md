# Linux 私房菜—主机规划与磁盘分区

### 2.1 Linux与硬件的搭配

Linux对于计算机各元件/设备的分辨， 与大家惯用的Windows系统完全不一样！因为，各个元件或设备在Linux下面都是“一个文件！

#### 2.1.1).认识计算机的硬件配备

- 支持度的考虑

  并非所有的产品都会支持特定的操作系统，这牵涉到硬件开发商是否有意愿提供适当的驱动程序之故。 因此，当我们想要购买或者是升级某些计算机元件时，应该要特别注意该硬件是否有针对您的操作系统提供适当的驱动程序， 否则，买了无法使用，那才是叫人呕死啊！因此，针对Linux来说，下面的硬件分析就重要啦！

#### 2.1.2).选择与Linux搭配的主机配备

如果你的Linux主要是作为小型服务器使用，并不负责学术方面的大量
运算， 而且也没有使用X Window的图形接口，那你的硬件需求只要像下面这样就差不多了：

- CPU CPU只要不是老旧到会让你的硬件系统死机的都能够支持！如同前面谈到的，目前（2015）的环境中， Intel i3 系列的CPU不算太旧而且性能也不错，非常好用了

- RAM 内存是越大越好！事实上在Linux服务器中，内存的重要性比CPU还要高的多！因为如果内存不够大， 就会使用到硬盘的内存交换空间（swap）。 而由计算机概论的内容我们知道硬盘比内存的速度要慢的多， 所以内存太小可能会影响到整体系统的性能的！

- Hard Disk 由于数据量与数据存取频率的不同，对于硬盘的要求也不相同。举例来说，如果是一般小型服务器，通常重点在于容量，硬盘容量大于20GB就够用到不行了！ 但如果你的服务器是作为备份或者是小企业的文件服务器，那么你可能就得要考虑较高阶的磁盘阵列（RAID）模式了.

  **磁盘阵列（RAID）是利用硬件技术将数个硬盘整合成为一个大硬盘的方法**，操作系统只会看到最后被整合起来的大硬盘。 由于磁盘阵列是由多个硬盘组成，所以可以达成速度性能、备份等任务。

- Network Interface Card 网卡是服务器上面最重要的元件之一了！目前的主板大多拥有内置10/100/1000Mbps的超高速以太网卡.

下面针对一般你可能会接触到的计算机主机的用途与相关硬件配备的基本要求来说明一下好了:

- 一般小型主机且不含X Window系统：
  - 用途：家庭用NAT主机（IP分享器功能）或小型企业之非图形接口小型主机。
  - CPU：五年内出产的产品即可。
  - RAM：至少512MB，不过还是大于1GB以上比较妥当！
  - 网卡：一般的以太网卡即可应付。
  - 显卡：只要能够被Linux捉到的显卡即可，例如NVidia或ATI的主流显卡均可。
  - 硬盘：20GB以上即可！

- 桌上型（Desktop）Linux系统/含X Window：
  - 用途：Linux的练习机或办公室（Office）工作机。
  - CPU：最好等级高一点，例如 Intel I5, I7 以上等级。
  - RAM：一定要大于1GB比较好！否则容易有图形接口停顿的现象。
  - 网卡：普通的以太网卡就好了！显卡：使用256MB以上内存的显卡！（入门级的都这个容量以上了）
  - 硬盘：越大越好，最好有60GB。

- **中型以上Linux服务器：**
  - 用途：中小型企业/学校单位的FTP/mail/WWW等网络服务主机。
    CPU：最好等级高一点，例如 I5, I7 以上的多核心系统。
  - RAM：最好能够大于1GB以上，大于4GB更好！
  - 网卡：知名的broadcom或Intel等厂牌，比较稳定性能较佳！
  - 显卡：如果有使用到图形功能，则一张64MB内存的显卡是需要的！
  - 硬盘：越大越好，如果可能的话，使用磁盘阵列，或者网络硬盘等等的系统架构，
  - 能够具有更稳定安全的传输环境，更佳！建议企业用计算机不要自行组装，可购买商用服务器较佳， 因为商用服务器已经通
    过制造商的散热、稳定性等测试，对于企业来说，会是一个比较好的选择

Red Hat的硬件支持：https://hardware.redhat.com/?pagename=hclOpen 

SuSE的硬件支持：http://en.opensuse.org/Hardware?LANG=en_UK

Linux对笔记本电脑的支持：http://www.linux-laptop.net/

Linux对打印机的支持：http://www.openprinting.org/

Linux硬件支持的中文HowTo：http://www.linux.org.tw/CLDP/HOWTO/hardware.html#hardware

#### 2.1.3).各硬件设备在Linux中的文件名

> 强调一下：“在Linux系统中，每个设备都被当成一个文件来对待”

SATA接口的硬盘的文件名称即为/dev/sd[a-d] , 括号内的字母为a-d当中的任意一个，亦即有/dev/sda, /dev/sdb, /dev/sdc, 及 /dev/sdd这四个文件的意思.

**Tips 这种中括号 [ ] 型式的表达式在后面的章节当中会使用得很频繁，请特别留意,另外先提出来强调一下，在Linux这个系统当中，几乎所有的硬件设备文件都在/dev这个目录内， 所以你会看到/dev/sda, /dev/sr0等等的文件名**

| 设备                | 设备在Linux内的文件名                                        |
| ------------------- | ------------------------------------------------------------ |
| SCSI/SATA/USB硬盘机 | /dev/sd[a-p]                                                 |
| USB闪存盘           | /dev/sd[a-p] （与SATA相同）                                  |
| VirtI/O界面         | /dev/vd[a-p] （用于虚拟机内）                                |
| 软盘机              | /dev/fd[0-7]                                                 |
| 打印机              | /dev/lp[0-2] （25针打印机） /dev/usb/lp[0-15] （USB 接口）   |
| 鼠标                | /dev/input/mouse[0-15] （通用） /dev/psaux （PS/2界面）/dev/mouse （当前鼠标） |
| CDROM/DVDROM        | /dev/scd[0-1] （通用） /dev/sr[0-1] （通用，CentOS 较常见）<br/>/dev/cdrom （当前 CDROM） |
| 磁带机              | /dev/ht0 （IDE 界面） /dev/st0 （SATA/SCSI界面） /dev/tape<br/>（当前磁带） |
| IDE硬盘机           | /dev/hd[a-d] （旧式系统才有）                                |

#### 2.1.4).使用虚拟机学习

因为虚拟化系统可以很简单的制作出相仿的硬件资源，因此我们在学习的时候，比较能够取得相同的环境来查阅学习的效果！由于虚拟化的软件非常之多，网络上也有一堆朋友的教学在。如果你的系统是 windows 系列的话，推荐你使用 virtualbox 这个软件！ 至于如果你原本就用 Linux 系统，例如
Fedora/Ubuntu 等系列的话，那么建议你使用原本系统内就有的虚拟机管理员来处理即可。目前 Linux 系统大多使用 KVM 这个虚拟化软件

### 2.2 磁盘分区

这一章在规划的重点是为了要安装Linux，那Linux系统是安装在计算机元件的那个部分呢？就是磁盘啦！所以我们当然要来认识一下磁盘先。 我们知道一块磁盘是可以被分区成多个分区（partition），以旧有的Windows观点来看，你可能会有一颗磁盘并且将他分区成为C:, D:,E:盘 但是Linux的设备都是以文件的型态存在，那分区的文件名又是什么？如何进行磁盘分区？磁盘分区有哪些限制？目前的 BIOS 与 UEFI分别是啥？MSDOS 与 GPT 又是啥？

#### 2.2.1 磁盘连接的方式与设备文件名的关系

例题：如果你的PC上面有两个SATA磁盘以及一个USB磁盘，而主板上面有六个SATA的插槽。这两个SATA磁盘分别安插在主板上的SATA1, SATA5插槽上， 请问这三个磁盘在Linux中的设备文件名为何？

答：由于是使用侦测到的顺序来决定设备文件名，并非与实际插槽代号
有关，因此设备的文件名如下：

1. SATA1插槽上的文件名：/dev/sda
2. SATA5插槽上的文件名：/dev/sdb
3. USB磁盘（开机完成后才被系统捉到）：/dev/sdc


#### 2.2.2 MSDOS（MBR）与GPT磁盘分区表（partition table）

- MSDOS （MBR） 分区表格式与限制

  早期的 Linux 系统为了相容于 Windows 的磁盘，因此使用的是支持 Windows 的MBR（Master Boot Record, 主要开机纪录区） 的方式来处理开机管理程序与分区表！而开机管理程序纪录区与分区表则通通放在**磁盘的第一个扇区**

  **第一个扇区 512Bytes 会有这两个数据：**

  - 主要开机记录区（Master Boot Record, MBR）：可以安装开机管理程序的地方，有446Bytes
  - 分区表（partition table）：记录整颗硬盘分区的状态，有64 Bytes

由于分区表所在区块仅有64 Bytes容量，因此最多仅能有四组记录区，每组记录区记录了该区段的启始与结束的柱面号码。 

上图中我们假设硬盘只有400个柱面，共分区成为四个分区，第四个分区所在为第301到400号柱面的范围。当你的操作系统为Windows时，那么第一到第四个分区的代号应该就是C, D,E, F。当你有数据要写入F盘时， 你的数据会被写入这颗磁盘的301~400号柱面之间的意思

为啥要分区啊？基本上你可以这样思考分区的角度：

- 数据的安全性： 因为每个分区的数据是分开的！所以，当你需要将某个分区的数据重整时，例如你要将计算机中Windows的C 盘重新安装一次系统时， 可以将其他重要数据移动到其他分区，例如将邮件、桌面数据移动到D 盘去，那么C 盘重灌系统并不会影响到D盘！ 所以善用分区，可以让你的数据更安全
- 系统的性能考虑： 由于分区将数据集中在某个柱面的区段，例如上图当中第一个分区位于柱面号码1~100号，如此一来当有数据要读取自该分区时， 磁盘只会搜寻前面1~100的柱面范围，由于数据集中了，将有助于数据读取的速度与性能！所以说，分区是很重要的！

既然分区表只有记录四组数据的空间，那么是否代表我一颗硬盘最多只能分区出四个分区？当然不是啦！有经验的朋友都知道， 你可以将一颗硬盘分区成十个以上的分区的！那又是如何达到的呢？在Windows/Linux系统中， 我们是通过刚刚谈到的延伸分区（Extended）的方式来处理的啦！延伸分区的想法是： 既然第一个扇区所在的分区表只能记录四笔数据， 那我
可否利用额外的扇区来记录更多的分区信息？实际上图示有点像下面这样

**实际上延伸分区并不是只占一个区块，而是会分佈在每个分区的最前面几个扇区来记载分区信息的！**

我们知道硬盘的四个分区记录区仅使用到两个，P1为主要分区，而P2则为延伸分区。请注意， 延伸分区的目的是使用额外的扇区来记录分区信息，延伸分区本身并不能被拿来格式化。 然后我们可以通过延伸分区所指向的那个区块继续作分区的记录。

MBR 主要分区、延伸分区与逻辑分区的特性我们作个简单的定义啰：

- 主要分区与延伸分区最多可以有四笔（硬盘的限制）
- 延伸分区最多只能有一个（操作系统的限制）
- 逻辑分区是由延伸分区持续切割出来的分区；
- 能够被格式化后，作为数据存取的分区为主要分区与逻辑分区。延伸分区无法格式化；
- 逻辑分区的数量依操作系统而不同，在Linux系统中SATA硬盘已经可以突破63个以上的分区限制；

事实上，分区是个很麻烦的东西，因为他是以柱面为单位的“连续”磁盘空间， 且延伸分区又是个类似独立的磁盘空间，所以在分区的时候得要特别注意。我们举下面的例子来解释一下好了：

在Windows操作系统当中，如果你想要将D与E盘整合成为一个新的分区，而如果有两、种分区的情况如下图所示， 图中的特殊颜色区块为D与E盘的示意，请问这两种方式是否均可以？

- 答：上图可以整合：因为上图的D与E同属于延伸分区内的逻辑分区，因此只要将两个分区删除，然后再重新创建一个新的分区， 就能够在不影响其他分区的情况下，将两个分区的容量整合成为一个。
- 下图不可整合：因为D与E分属主分区与逻辑分区，两者不能够整合在一起。除非将延伸
- 分区破坏掉后再重新分区。 但如此一来会影响到所有的逻辑分区，要注意的是：**如果延伸分区被破坏，所有逻辑分区将会被删除。** 因为逻辑分区的信息都记录在延伸分区里面。

由于第一个扇区所记录的分区表与MBR是这么的重要，几乎只要读取硬盘都会先由这个扇区先读起。 因此，如果整颗硬盘的第一个扇区（就是MBR与partition table所在的扇区）物理实体坏掉了，那这个硬盘大概就没有用了！ 因为系统如果找不到分区表，怎么知道如何读取柱面区间呢？

如果我想将一颗大硬盘“暂时”分区成为四个partitions，同时还有其他的剩余容量可以让我在未来的时候进行规划， 我能不能分区出四个Primary？若不行，那么你建议该如何分区？
答：

- 由于Primary+Extended最多只能有四个，其中Extended最多只能有一个，这个例题想要分区出四个分区且还要预留剩余容量， 因此P+P+P+P的分区方式是不适合的。因为如果使用到四个P，则即使硬盘还有剩余容量， 因为无法再继续分区，所以剩余容量就被浪费掉了
- 假设你想要将所有的四笔记录都花光，那么P+P+P+E是比较适合的。所以可以用的四个partitions有3个主要及一个逻辑分区， 剩余的容量在延伸分区中。
- 如果你要分区超过4个以上时，一定要有Extended分区，而且必须将所有剩下的空间都配给Extended， 然后再以logical的分区来规划Extended的空间。 另外，考虑到磁盘的连续性，一般建议将Extended的柱面号码分配在最后面的柱面内

MBR 分区表除了上述的主分区、延伸分区、逻辑分区需要注意之外，由于每组分区表仅有16Bytes 而已，因此可纪录的信息真的是相当有限的！ 所以，在过去 MBR 分区表的限制中经常可以发现如下的问题：

- 操作系统无法抓取到 2.2T 以上的磁盘容量！
- MBR 仅有一个区块，若被破坏后，经常无法或很难救援。
- MBR 内的存放开机管理程序的区块仅 446Bytes，无法容纳较多的程序码。

这个 2.2TB 限制的现象在早期并不会很严重。但是，近年来硬盘厂商动不对推出的磁盘容量就高达好几个 TB 的容量！目前 （2015） 单一磁盘最大容量甚至高达 8TB 了！ 如果使用磁盘阵列的系统，用了 24 颗 4TB 磁盘搭建出磁盘阵列，那在 Linux 下面就会看到有一颗 70TB 左右的磁盘！ 如果使用 MBR 的话...那得要 2TB/2TB 的割下去，虽然 Linux kernel 现在已经可以通过某些机制让磁盘分区高过 63 个以上，但是这样就得要割出将近 40 个分区～ 真要命... 为了解决这个问题，所以后来就有 GPT 这个磁盘分区的格式出现了！

**GUID partition table, GPT 磁盘分区表[1]**

因为过去一个扇区大小就是 512Bytes 而已，不过目前已经有 4K 的扇区设计出现！为了相容于所有的磁盘，因此在扇区的定义上面， 大多会使用所谓的逻辑区块位址（Logical Block Address, LBA）来处理。GPT 将磁盘所区块以此 LBA（默认为 512Bytes 喔！） 来规划，而第一个 LBA 称为 LBA0 （从 0 开始编号）。

与 MBR 仅使用第一个 512Bytes 区块来纪录不同， GPT 使用了 34 个 LBA 区块来纪录分区信息！GPT 除了前面 34 个LBA 之外，整个磁盘的最后 33 个 LBA 也拿来作为另一个备份

- LBA0 （MBR 相容区块）

  与 MBR 模式相似的，这个相容区块也分为两个部份，一个就是跟之前 446 Bytes 相似的区块，储存了第一阶段的开机管理程序！ 而在原本的分区表的纪录区内，这个相容模式仅放入一个特殊标志的分区，用来表示此磁盘为 GPT 格式.不懂 GPT 分区表的磁盘管理程序， 就不会认识这颗磁盘.

- LBA1 （GPT 表头纪录）

  这个部份纪录了分区表本身的位置与大小，同时纪录了备份用的 GPT 分区 （就是前面谈到的在最后 34 个 LBA 区块） 放置的位置， 同时放置了分区表的检验机制码（CRC32），操作系统可以根据这个检验码来判断 GPT 是否正确。若有错误，还可以过这个纪录区来取得备份的 GPT（磁盘最后的那个备份区块） 来恢复 GPT 的正常运行.

- LBA2-33 （实际纪录分区信息处）

  现在 GPT 分区默认可以提供多达 128 笔纪录，而在 Linux 本身的核心设备纪录中，针对单一磁盘来说，虽然过去最多只能到达 15 个分区，不过由于 Linux kernel 通过 udev 等方式的处理，现在 Linux 也已经没有这个限制在了！ 此外，GPT 分区已经没有所谓的主、延伸、逻辑
  分区的概念，既然每笔纪录都可以独立存在， 当然每个都可以视为是主分区！每一个分区都可以拿来格式化使用！

**总结：**

**一直以为核心认识的设备主要/次要号码就一定是连续的，因此一直没有注意到由于新的机制的关系，分区已经可以突破核心限制的状况。虽然新版的 Linux 大多认识了 GPT 分区表，没办法，我们 server 常常需要比较大容量的磁盘！不过，在磁盘管理工具上面， fdisk 这个老牌的软件并不认识 GPT 喔！要使用 GPT 的话，得要操作类似 gdisk 或者是 parted 指令才行！这部份我们会在第二篇再来谈一谈。 另外，开机管理程序方面， grub 第一版并不认识 GPT 喔！得要 grub2 以后才会认识的！开机管理程序这部份则第五篇再来谈！**

**并不是所有的操作系统都可以读取到 GPT 的磁盘分区格式，！同时，也不是所有的硬件都可以支持 GPT 格式，是否能够读写 GPT 格式又与开机的检测程序有关，开机的检测程序又是什么？开机检验程序就是BIOS 与UEFI了**

#### 2.2.3).开机流程中的BIOS与UEFI开机自检程序

> 没有执行软件的硬件是没有用的，除了会电人之外...，为了计算机资源的合理分配，所以有了操作系统这个系统软件的产生。由于操作系统会控制所有的硬件功能并且提供核心功能，因此我们的计算机就能够认识硬盘内的文件系统，进一步读取硬盘内的软件文件，与执行软件来达成各项软件的执行目的。

**既然操作系统是软件，那么计算机是如何认识操作系统这个系统软件并且执行它？**基本上，目前的主机系统在载入硬件驱动方面的程序，主要有早期的 BIOS 与新的 UEFI 两种机制，我们分别来看

- BIOS 搭配 MBR/GPT 的开机流程

  CMOS是记录各项硬件参数的一个储存器（被嵌入到主板上面）。BIOS则是一个写入到主板上的固件（固件就是写入到硬件上的一个软件程序）BIOS就是开机时，计算机系统自动执行的第一个程序。然后BIOS的功能就是：分析计算机里有哪些储存设备：比如硬盘，BIOS根据你的个人设备的情况去取得能够开机的硬盘，并且在硬盘里面去读取第一扇区MBR的位置，MBR这个仅仅有446Bytes的硬盘容量里会放置最基本的开机管理程序。然后BIOS的使命完成。接下来让MBR内的开机管理程序工作。

  这个开机管理程序的目的是：载入核心文件，因为**开机管理程序是操作系统在安装**的时候提供的，它认识硬盘内的文件系统格式，因此它可以读取到核心文件，然后接下来读取核心文件，在接下来让核心文件去工作。至此**开机管理程序与BIOS的工作圆满完成。**之后就是 **操作系统接手，开始工作。**总的流程如下：

  - BIOS：开机主动执行的程序(固件)
  - MBR：第一个开机设备的第一扇区内的主要开机记录区块，含开机管理程序。
  - 开机管理程序：可以读取核心文件的程序。
  - 核心文件开始工作，开始操作系统的功能。

**第二点要注意，如果你的分区表为 GPT 格式的话，那么 BIOS 也能够从 LBA0 的 MBR 相容区块读取第一阶段的开机管理程序码， 如果你的开机管理程序能够认识 GPT 的话，那么使用BIOS 同样可以读取到正确的操作系统核心喔！换句话说， 如果开机管理程序不懂 GPT ，例如 Windows XP 的环境，那自然就无法读取核心文件，开机就失败了**

**注意！！！！**因为LBA0仅仅提供第一阶段的开机管理程序码，你如果使用类似Grub的开机管理程序，那么就得额外分出一个BIOS BOOt 的分区。这个分区可以放置其他开机程序的程序码。在CentOS中，这个分区通常只占了2MB左右。

**BIOS与MBR都是硬件本身会支持的功能，至于Boot loader则是操
作系统安装在MBR上面的一套软件了。由于MBR仅有446 Bytes而已，因此这个开机管理程序是非常小而美的。 这个boot loader的主要任务有下面这些项目：**

- 提供菜单：使用者可以选择不同的开机项目，这也是多重开机的重要功能！
- 载入核心文件：直接指向可开机的程序区段来开始操作系统
- 转交其他loader：将开机管理功能转交给其他loader负责。

上面前两点还容易理解，但是第三点很有趣喔！那表示你的计算机系统里面可能具有两个以上的开机管理程序呢！我们的硬盘不是只有一个MBR而已？是没错啦！但是开机管理程序除了可以安装在MBR之外， 还可以安装在每个分区的开机扇区（boot sector）

我们举一个例子来说，假设你的个人计算机只有一个硬盘，里面切成四个分区，其中第二分区分别安装了Windows及Linux， 你要如何在开机的时候选择用Windows还是Linux开机呢？假设MBR内安装的是可同时认识Windows/Linux操作系统的开机管理程序， 那么整个流程入下：

MBR的开机管理程序提供两个菜单：

- **菜单一（M1）可以直接载入Windows的核心文件来开机；**
- 菜单二（M2）则是将开机管理工作交给第二个分区的**Boot Sector**

如果开机的时候，选择菜单二，那么整个开机管理程序就会交给第二分区的开机管理程序。第二个分区的开机管理程序里面有一个菜单，因此可以使用Linux的核心文件来开机了。

- 每个分区都有自己的开机扇区（boot Sector）

- 图中的系统盘为第一几第二分区

- 实际的可开机的核心文件放置在各个分区内的

- Loader只会认识自己系统盘里的可开机的文件，以及其他loader

- loader可直接指向或者间接把管理管理权交给另外一个管理程序。

  人家常常说：“如果要安装多重开机， 最好先安装Windows再安装
  Linux”呢？

  答：Linux在安装的时候，你可以选择把开机管理程序安装在MBR或者别的分区的开机扇区，并且Linux的Loader可以手动设置菜单，你可以Linux的boot里面加入Windows的开机选项。

  ​        Windows在安装的时候，它的安装程序会主动覆盖掉原来的MBR以及自己所在分区的开机扇区。你没有选择的机会，而且没有菜单让你去自己选择功能。

  

**如果你先安装了Linux，后安装了windows，那么MBR的开机管理程序只会有Windows的选项，不会有Linux选项，原本在MBR内的Linux的开机管理程序会被覆盖掉。那需要重新安装Linux一次吗？当然不需要，你只要用尽各种方法来处理MBR的内容即可。 例如利用Linux的救援模式来挽救MBR啊！**

**开机管理程序与Boot sector的观念是非常重要的，但是最先搞清楚**

**（1）开机需要开机管理程序， 而（2）开机管理程序可以安装在MBR及Boot Sector（每个分区的开机扇区）两处这两个观念有基本的认识即可， 一开始就背太多东西会很混乱啦！**

- **UEFI BIOS 搭配 GPT 开机的流程 [2]**

我们现在知道 GPT 可以提供到 64bit 的寻址，然后也能够使用较大的区块来处理开机管理程序。但是 **BIOS 其实不懂 GPT,**还得**要通过 GPT 提供相容模式才能够读写这个磁盘设备** 所以有了UEFI （Unified Extensible Firmware Interface） 这个统一可延伸固件界面的产生。

**UEFI 主要是想要取代 BIOS 这个固件界面，因此我们也称 UEFI 为 UEFI BIOS**UEFI 使用 C 程序语言，比起使用组合语言的传统 BIOS 要更容易开发！也因为使用 C 语言来撰写，因此如果开发者够厉害，甚至可以在 UEFI 开机阶段就让该系统了解 TCP/IP 而直接上网！ 根本不需要进入操作系统耶！这让小型系统的开发充满各式各样的可能性。

| 比较项目               | 传统的BIOS                                                   | UEFI               |
| ---------------------- | ------------------------------------------------------------ | ------------------ |
| 使用程序语言           | 组合语言                                                     | C 语言             |
| 硬件资源控制           | 使用中断 （IRQ） 管理 不可变的内存存取 不可 变得输入/输出存取 | 使用驱动程序与协定 |
| 处理器运行环境         | 16 位                                                        | CPU 保护模式       |
| 扩充方式               | 通过 IRQ 链接                                                | 直接载入驱动程序   |
| 第三方厂商支持         | 较差                                                         | 较佳且可支持多平台 |
| 图形化能力             | 较差                                                         | 较佳               |
| 内置简化操作系统前环境 | 不支持                                                       | 支持               |

**从上头我们可以发现，与传统的 BIOS 不同，UEFI 简直就像是一个低阶的操作系统～甚至于连主板上面的硬件资源的管理， 也跟操作系统相当类似，只需要载入驱动程序即可控制操作。**

UEFI 当初在发展的时候，就制定一些控制在里头，包括硬件资源的管理使用轮询 （polling）的方式来管理，，另外，UEFI 并不能提供完整的高速缓存功能，因此执行效率也没有办法提升。不过由于载入所有的 UEFI 驱动程序之后， 系统会打开一个类似操作系统的 shell 环境，，使用者可以此环境中执行任意的 UEFI 应用程序，而且效果比 MSDOS 更好哩

所以啰，因为效果华丽但性能不佳，因此这个 UEFI 大多用来作为启动操作系统之前的硬件检测、开机管理、软件设置等目的，基本上是比较难的。 同时，当载入操作系统后，一般来说，UEFI 就会停止工作，并将系统交给操作系统，这与早期的 BIOS 差异不大。比较特别的是，某些特定的环境下， 这些 UEFI 程序是可以部份继续执行的，以协助些操作系统无法找到特定设备时，该设备还是可以持续运行。

此外，由于过去 cracker 经常借由 BIOS 开机阶段来破坏系统，并取得系统的控制权，因此UEFI 加入了一个所谓的安全启动 （secure boot） 机制， 这个机制代表着即将开机的操作系统必须要被 UEFI 所验证，否则就无法顺利开机！微软用了很多这样的机制来管理硬件。 不过加入这个机制后，许多的操作系统，包括 Linux ，就很有可能无法顺利开机喔！所以，某些时刻，你可能得要将 UEFI 的 secure boot 功能关闭， 才能够顺利的进入 Linux 哩！ （这一点让自由软件工作者相当感冒啦！）

另外，与 BIOS 模式相比，虽然 UEFI 可以直接取得 GPT 的分区表，不过最好依旧拥有BIOS boot 的分区支持， 同时，为了与 windows 相容，并且提供其他第三方厂商所使用的UEFI 应用程序储存的空间，你必须要格式化一个 vfat 的文件系统， 大约提供 512MB 到 1G左右的容量，以让其他 UEFI 执行较为方便

**总结：s 由于 UEFI 已经克服了 BIOS 的 1024 柱面的问题，因此你的开机管理程序与核心可以放置在磁盘开始的前 2TB 位置内即可！加上之前提到的 BIOS boot 以及 UEFI 支持的分区，基本上你的 /boot 目录几乎都是 /dev/sda3 之后的号码了！这样开机还是没有问题的！所以要注意喔！与以前熟悉的分区状况已经不同， /boot 不再是 /dev/sda1 。**

#### 2.2.4).Linux安装模式下，磁盘分区的选择（及其重要！！

在 windows 系统重灌之前，你可能都会事先考虑，到底系统盘 C 盘要有多少容量？而数据碟D 盘又要给多大容量等等， 然后实际安装的时候，你会发现到其实 C 盘之前会有个 100MB的分区被独立出来～所以实际上你就会有三个分区就是了。那 Linux 下面又该如何设计类似的东西呢？

- 目录树结构

  过Linux内的所有数据都是以文件的形态来呈现的

  所谓的目录树架构（directory tree）就是以根目录为主，然后向下呈现分支状的目录结构的一种文件架构，整个目录树架构最重要的就是那个根目录（root directory），这个根目录的表示方法为一条斜线“/”， 所有的文件都与目录树有关。

  所有的文件都是由根目录（/）衍生而来，。那当我们想要取得mydata那个文件时，系统就得由根目录开始找，然后找到home接下来找到dmtsai， 最终的文件名为：/home/dmtsai/mydata的意思。

我们现在知道整个Linux系统使用的是目录树架构，但是我们的文件数据其实是放置在磁盘分区当中的， 现在的问题是“**如何结合目录树的架构与磁盘内的数据**”呢？ 这个时候就牵扯到“挂载（mount）”的问题啦！

- **文件系统与目录树的关系（挂载）**

  **所谓的“挂载”就是利用一个目录当成进入点，将磁盘分区的数据放置在该目录下；也就是说：进入该目录就可以读取该分区的意思。这个动作我们叫做“挂载”，那个进入点的目录就是我们说的挂载点。因为Linux最重要的就是根目录，所以根目录必须挂载到某个分区。其他的目录可以根据需要挂载到不同的分区。**

  这个的意思是说：举个例子，假如我有两个分区，根目录挂载到了分区1 ，但是根目录下面的Home目录被挂载到分区2，也就是说，不在home目录下面的目录，其余的目录都被被放置在分区1。

  判断某个文件在哪个分区下面——“先追踪到谁，就在谁下面。”例如/home/vbird/test这个文件在哪个partition，由由test --> vbird --> home --> /看哪个进入点先被查到。Test使用的是/home这个进入点，而不是/ .

  **例题：**现在让我们来想一想，我的计算机系统如何读取光盘内的数据呢？

  **答：**在Windows里面使用的是“光驱”的代号方式处理（假设为E盘时）

  但在Linux下面我们依旧使用目录树喔！在默认的情况下，Linux是将光驱的数据放置到/media/cdrom里头去的。

  **例题**:如果光盘片里面有个文件文件名为“我的文件”时，那么这个文件是在哪里？

  **答：Windows： 桌面\我的计算机\E:\我的文件**

  **Linux： /media/cdrom/我的文件**，如果光驱并非被挂载到/media/cdrom，而是挂载到/mnt这个目录时，刚刚读取的这个文件的文件名会变成：/mnt/我的文件

  如果你了解这个文件名，这表示你已经知道挂载的意义了！初次接触Linux时，这里最容易搞混，因为他与Windows的分区代号完全不一样！

**distributions安装时，挂载点与磁盘分区的规划：**

> 因为Linux使用的是目录树系统，所以在安装时，就要规划磁盘分区与目录树的挂载。但是Linux本身因为提供了一种默认模式让你去选择分区方式。不过，分区的结果可能都不是很符合自己主机的样子。强烈建议使用：Custom 这个安装模式，在某些Linux Distribution 中会把这个模式写的很厉害，叫做Expert模式。

- 自订安装“Custom”：

  - A：初次接触Linux：只要分区“ / ”及“swap”即可：

    通常初次安装Linux系统的朋友们，我们都会建议他直接以一个最大的分区“ / ”来安装系统。 **这样作有个好处，就是不怕分区错误造成无法安装的困境** 例如/usr是Linux的可执行程序及相关的文件摆放的目录，它的容量需求还是蛮大的，万一你分区给了usr/但是给的不够大，那么就会出现：数据无法写入的问题。就有可能出现无法安装的问题。所以第一次安装时 ，使用/与Swap即可。

  - B：建议分区的方法：预留一个备用的剩余磁盘容量！

    在学习Linux时，最麻烦的可能就是得要常常处理分区的问题，因为分区是系统管理员很重要的一个任务。 但如果你将整个硬盘的容量都用光了，那么你要如何练习分区。预留的分区也可以拿来做为备份之用。因为我们在实际操作Linux系统的过程中， 可能会发现某些script或者是重要的文件很值得备份时，就可以使用这个剩余的
    容量分区出新的分区， 并使用来备份重要的配置文件或者script。

    还有个好处是：当我们重新安装Linux时，我的一些软件工具马上就可以在硬盘中找到。选择Linux安装程序提供的默认硬盘分区方式：

- **选择Linux安装程序提供的默认硬盘分区方式：**

### 2.3 安装Linux前的规划

安装最重要的第一件事，就是要取得Linux distributions的光盘数据

#### 2.3.1).选择适当的distribution

如果是将Linux定位在服务器上面的话，那么Red Hat Enterprise Linux及SuSE Enterprise Linux应该是很不错的选择，因为他的版本更动幅度较小，并且更新支持的期限较长的原因。

**总结：**你所下载的文件扩展名是.iso，这就是所谓的image文件（镜像文件）。这种image文件是由光盘直接烧录成文件的， 文件非常的大，建议你不要使用浏览器（IE/Firefox..）来下载，可以使用FTP用户端程序来下载，例如Filezilla （http://filezilla-project.org/download.php）等。这样比较不需要担心断线的问题，因为可以续传啊！

> ftp客户端，是在互联网上提供存储空间的计算机，它们依照ftp协议提供服务。
>
> Internet上早期实现传输文件，并不是一件容易的事，我们知道 Internet是一个非常复杂的计算机环境，有PC，有工作站，有MAC，有大型机，据统计连接在Internet上的计算机已有上千万台，而这些计算机可能运行不同的操作系统，有运行Unix的服务器，也有运行Dos、Windows的PC机和运行MacOS的苹果机等等，而各种操作系统之间的文件交流问题，需要建立一个统一的文件传输协议，这就是所谓的ftp

**总结：所谓的Ftp协议就是，各种不同操作系统间进行统一的文件传输的协议。但是不同的操作系统有不同的FTP应用程序，所有的这些应用程序都都遵循同一种协议。用户可以把自己的文件传给别人也可以把别人的环境中获得文件。**

与大多数Internet服务一样，ftp也是一个客户机/服务器系统。用户通过一个支持ftp协议的客户机程序，连接到在远程主机上的ftp服务器程序。用户通过客户机程序向服务器程序发出命令，服务器程序执行用户所发出的命令，并将执行的结果返回到客户机，比如说，用户发出一条命令，要求服务器向用户传送某一个文件的一份拷贝，服务器会响应这条命令，将指定文件送至用户的机器上。客户机程序代表用户接收到这个文件，将其存放在用户目录中。

在ftp的使用当中，用户经常遇到两个概念:"下载"(Download)和"上传"(Upload)。"下载"文件就是从远程主机拷贝文件至自己的计算机上;"上传"文件就是将文件从自己的计算机中拷贝至远程主机上。用Internet语言来说，**用户可通过客户机程序向(从)远程主机上传(下载)文件**。

使用ftp时必须首先登录，在远程主机上获得相应的权限以后，方可上传或下载文件。也就是说，要想同哪一台计算机传送文件，就必须具有哪一台计算机的适当授权。换言之，除非有用户ID和口令，否则便无法传送文件。这种情况违背了Internet的开放性，Internet上的ftp主机何止千万，不可能要求每个用户在每一台主机上都拥有帐号。匿名ftp就是为解决这个问题而产生的。

FTP服务器是在互联网上提供文件存储和访问服务的计算机，它们依照FTP协议提供服务。 FTP是File Transfer Protocol(文件传输协议)。顾名思义，就是专门用来传输文件的协议。简单地说，支持FTP协议的服务器就是FTP服务器。根据本地网络环境，选择使用动态域名解析或[内网映射](https://hsk.oray.com/)，对应解决动态公网IP和无公网IP的问题。

#### 2.3.2). 主机的服务规划与硬件的关系

在一般小型企业或学校单位中， 常见的某些服务与你的硬件关系有哪些？

- NAT（达成IP分享器的功能）：

通常小型企业或者是学校单位大多仅会有一条对外的连线，然后全公司/学校内的计算机全部通过这条连线连到网际网络上。 此时我们就得要使用IP分享器来让这一条对外连线分享给所有的公司内部员工使用。 那么Linux能不能达到此一IP分享的功能呢？当然可以，就是通过NAT服务即可达成这项任务了！

在这种环境中，由于Linux作为一个内/外分离的实体，因此网络流量会比较大一点。此时Linux主机的网卡就需要比较好些的配备.单利用Linux作为NAT主机来分享IP是很不智的～因为PC的耗电能力比IP分享器要大的多。

那么为什么你还要使用Linux作为NAT呢？因为Linux NAT还可以额外的加装很多分析软件，可以用来分析用户端的连线，或者是用来控制带宽与流量，达到更公平的带宽使用呢！ 

- SAMBA（加入Windows网络上的芳邻）：

  在你的Windows系统之间如何传输数据呢？当然就是通过网络上的芳邻来传输啦！那还问。 这也是学校老师在上课过程中要分享数据给同学常用的机制了。问题是，Windows 7 的网芳一般只能同时分享十部用户端连线，超过的话就得要等待了～真不人性化

  我们可以使用Linux上面的SAMBA这个软件来达成加入Windows网芳的功能喔！SAMBA的性能不错， 也没有用户端连线数的限制，相当适合于一般学校环境的文件服务器（file server）的角色呢！

这种服务器由于分享的数据量较大，对于系统的网卡与硬盘的大小及速度就比较重要。

- Mail（邮件服务器）：

  邮件服务器是非常重要的，虽然免费的信箱已经非常够用了，问题是， 如
  果你是一间私人单位的公司，你的公司内传送的email是具有商业机密或隐私性的，那你还想要交给免费信箱去管理吗？ 此时才有需要架设mail server。在mail server上面，重要的也是硬盘容量与网卡速度，在此情境中，也可以将/var目录独立出来，并加大容量。

- Web（WWW服务器）：

  WWW服务器几乎是所有的网络主机都会安装的一个功能，因为他除了可以提供Internet的WWW连线之外， 很多在网络主机上面的软件功能（例如某些分析软件所提供的最终分析结果的画面）也都使用WWW作为显示的接口， 所以这家伙真是重要到不行的。

  CentOS使用的是Apache这套软件来达成WWW网站的功能，在WWW服务器上面，如果你还有提供数据库系统的话， 那么CPU的等级就不能太低，而最重要的则是RAM了！

- DHCP（提供用户端自动取得IP的功能）：

  如果你是个区域网络管理员，你的区网内共有20部以上的计算机给一般员工使用，这些员工假设并没有计算机网络的维护技能。 那你想要让这些计算机在连上Internet时需要手动去设置IP还是他可以自动的取得IP呢？当然是自动取得比较方便啦！ 这就是DHCP服务的功能了！用户端计算机只要选择“自动取得IP”，其他的，就是你系统管理员在DHCP服务器上面设置一下即可。

- FTP：

  大致上我们会安装的服务器软件就是这一些啰！ 当然啦，还是那句老话，在目前你刚接触Linux的这个阶段中，还是以Linux基础为主，希望你先了解Linux的相关主机操作技巧，其他的建站，未来再谈吧！ 而上面列出的各项服务，仅是提供给你，如果想要架设某种网络服务的主机时，你应该如何规划主机比较好！

#### 2.3.3).主机硬盘的主要规划

由于Linux是多用户多任务的环境，因此很可能上面已经有很多人的数据在其中了， 如果需要重新安装的话，光是搬移与备份数据就会疯掉了！所以硬盘的分区考虑是相当重要的！

**下面还是说明一下基本硬盘分区的模式:**

- 最简单的分区方法：

  是仅分区出根目录与内存交换空间（ / & swap ）即可

- 稍微麻烦一点的方式：

  先分析这部主机的未来用途，然后根据用途去分析需要较大容量的目录,以及读写较为频繁的目录,将这些重要的目录分别独立出来而不与根目录放在一起在默认的CentOS环境中，下面的目录是比较符合容量大且（或）读写频繁的目录：

  - /boot
  - /
  - /home
  - /var
  - Swap

#### 2.3.4).两个实际案例

**案例一：家用的小型Linux服务器，IP分享与文件分享中心：**

- 提供服务： 提供家里的多部计算机的网络连线分享，所以需要NAT功能。提供家庭成员的数据存放容量，由于家里使用Windows系统的成员不少， 所以创建SAMBA服务器，提供网芳的网络磁盘功能

- 主机硬件配备：
  CPU使用 AMD Athlon 4850e 省电型 CPU内存大小为 4GB两张网卡，控制芯片为常见的螃蟹卡（Realtek）只有一颗 640GB 的磁盘,显卡为 CPU 内的内置显卡 （Radeon HD 3200,安装完毕后将屏幕,键盘,鼠标,DVD-ROM等配备均移除，仅剩下网络线与电源线。

- 硬盘分区：

  分成 /, /usr, /var, /tmp等目录均独立；
  1 GB的Swap；
  安装比较过时的 CentOS 5.x 最新版

**案例二：提供Linux的PC丛集（Cluster）计算机群：**

- 提供服务： 提供研究室成员对于模式仿真的软、硬件平台，主要提供的服务并非网际网络服务，而是研究室内部的研究工作分析。
- 主机硬件配备：
  - 利用两部多核系统处理器 （一部 20核 40绪，一部 12核 24绪），搭配 10G 网卡组合而成
  - 使用内置的显卡
  - 运算用主机仅一颗磁盘，储存用主机提供 8 颗 2TB 磁盘组成的磁盘阵列
  - 一部 128GB 内存，一部 96GB 内存

- 硬盘分区：
  - 运算主机方面，整颗磁盘仅分 /boot, / 及 swap 而已
  - 储存主机方面，磁盘阵列分成两颗磁盘，一颗 100G 给系统用，一颗 12T 给数据用。系统磁盘用的分区为 /boot, /, /home, /tmp, /var 等分区， 数据磁盘全部容量规划在同一个分区而已。

上面的案例中，案例一是属于小规模的主机系统，因此只要使用预计被淘汰的配备即可进行主机的架设！ 唯一可能需要购买的大概是网卡吧！呵呵！而在案例二中，由于我需要大量的数值运算， 且运算结果的数据非常的庞大，因此就需要比较大的磁盘容量与较佳的网络系统了。

### 2.4 重点回顾

- 新添购计算机硬件配备时，需要考虑的角度有“游戏机/工作机”、“性能/价格比”、“性能/消耗瓦数”、“支持度”等

- 旧的硬件配备可能由于保存的问题或者是电子零件老化的问题，导致计算机系统非常容易在运行过程中出现不明的死机情况

- 在Linux系统中，每个设备都被当成一个文件来对待，每个设备都会有设备文件名

- 磁盘设备文件名通常分为两种，实际SATA/USB设备文件名为/dev/sd[a-p]，而虚拟机的设备可能为/dev/vd[a-p]

- 磁盘的第一个扇区主要记录了两个重要的信息，分别是： （1）主要开机记录区：可以安装开机管理程序的地方，有446 Bytes （2）分区表：记录记录整颗硬盘分区的状态，有64 Bytes

- 磁盘的 MBR 分区方式中，主要与延伸分区最多可以有四个，逻辑分区的设备文件名号码，一定由5号开始

- 如果磁盘容量大于 2TB 以上时，系统会自动使用 GPT 分区方式来处理磁盘分区。

- GPT 分区已经没有延伸与逻辑分区的概念，你可以想像成所有的分区都是主分区！

- 某些操作系统要使用 GPT 分区时，必须要搭配 UEFI 的新型 BIOS 格式才可安装使用。

- 开机的流程由：**BIOS-->MBR-->-->boot loader-->核心文件**；

- boot loader的功能主要有：提供菜单、载入核心、转交控制权给其他loader

- boot loader可以安装的地点有两个，分别是 MBR 与 boot sector

- Linux操作系统的文件使用目录树系统，与磁盘的对应需要有“挂载”的动作才行；

  