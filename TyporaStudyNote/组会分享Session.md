## **什么是 Session?**

> Session 代表着服务器和客户端一次会话的过程。Session 对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当客户端关闭会话，或者 Session 超时失效时会话结束。

**session，中文经常翻译为会话，其本来的含义是指有始有终的一系列动作 / 消息。比如打电话是从拿起电话拨号到挂断电话这中间的一系列过程可以称之为一个 session**。然而当 session 一词与网络协议相关联时，它又往往隐含了 “面向连接” 和 / 或 “保持状态” 这样两个含义。

session 在 Web 开发环境下的语义又有了新的扩展，它的含义是指一类用来在**<u>客户端与服务器端之间保持状态的解决方案</u>**。有时候 Session 也用来指这种解决方案的存储结构。

**session 应用在网络协议和Web开发中，我们先来简单了解一下最简单的协议Http协议。**



#### 1.**什么是Http协议？**

**答:~~HTTP是什么呢？它是超文本传输协议，HTTP是缩写，它的全英文名是HyperText Transfer Protocol。~~不用那么复杂，你之需要知道它就是客户端与服务器用来传输“东西”的。**

<img src="https://image-static.segmentfault.com/781/048/781048455-5df78039967fa_articlex" alt="在这里插入图片描述" style="zoom:200%;" />

#### 2.**Http协议是无状态的**

**无状态就是：**

```
 夏洛：大爷，楼上322住的是马冬梅家吧？
 
 大爷：马都什么？
 
 夏洛：马冬梅。
 
 大爷：什么都没啊？
 
 夏洛：马冬梅啊。

 大爷：马什么没？

 夏洛：行，大爷你先凉快着吧。
```

一次对话完成后下一次对话完全不知道上一次对话发生了什么。如果在Web服务器中只是用来管理静态文件还好说，对方是谁并不重要，把文件从磁盘中读取出来发出去即可。但是随着网络的不断发展，比如电商中的购物车只有记住了用户的身份才能够执行接下来的一系列动作。所以此时就需要我们**无状态**的服务器记住一些事情。

**假如你点击物品，把某个商品加入到自己的购物车，你的这个点击操作，并不会告诉服务器，是你点击的，还是张三、李四点击的 。**

所以服务器做了这么几件事。

- **为特定的用户创建特定的Session,用来标志这个用户，并且要跟踪用户， *（就是储存用户相关的信息）*这样才知道你的购物车里到底有几件衣服，几本书.**

#### 3.怎么识别特定的用户？

好的，我们既然已经通过session来标志不同的用户（比如说，你是session1,他是session2），那么服务器怎么来识别特定的用户？



<img src="https://image-static.segmentfault.com/781/048/781048455-5df78039967fa_articlex" alt="在这里插入图片描述" style="zoom:200%;" />



**这个时候Cookie就登场了。**

服务器给每个客户端都贴上了一个小纸条（**Cookie**）。上面记录了服务器给我们返回的一些信息。然后服务器看到这张小纸条就知道我们是谁了。



#### 4.**为什么需要 Cookie ?**

> **说起来为什么需要 Cookie ，这就需要从浏览器开始说起，我们都知道浏览器是没有状态的(HTTP 协议无状态)，这意味着浏览器并不知道是张三还是李四在和服务端打交道。**

**这个时候就需要有一个机制来告诉服务端，本次操作用户是否登录，是哪个用户在执行的操作，那这套机制的实现就需要 Cookie 和 Session 的配合。**

**每次Http请求的时候（你点击按钮，把某个物品加到购物车，这个操作要发送），客户都会发送相应的Cookie到服务端，大多数的应用都是通过Cookie来实现Session的跟踪的。**

<img src="https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2020%2F0506%2F82b5d515j00q9x0tj000kc000hl008hc.jpg&thumbnail=650x2147483647&quality=80&type=jpg" alt="img" style="zoom:200%;" />

**每次HTTP请求的时候，客户端都会发送相应的Cookie信息到服务端。所以在第一次创建Session的时候，服务端会在HTTP协议中告诉客户端，需要在 Cookie 里面记录一个Session ID，以后每次请求把这个会话ID发送到服务器，我就知道你是谁了。**

- **用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建创建对应的 Session ，请求返回时将此 Session 的唯一标识信息 `SessionID` 返回给浏览器，浏览器接收到服务器返回的 `SessionID` 信息后，会将此信息存入到 Cookie 中，同时 Cookie 记录此 `SessionID` 属于哪个域名。**
- **当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 Cookie 信息，如果存在自动将 Cookie 信息也发送给服务端，服务端会从 Cookie 中获取 `SessionID`，再根据 `SessionID` 查找对应的 Session 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 Session 证明用户已经登录可执行后面操作。**

**SessionID 是连接 Cookie 和 Session 的一道桥梁，大部分系统也是根据此原理来验证用户登录状态。**



### 总结：

**Session是在服务端保存的一个数据结构，用来跟踪用户的状态，这个数据可以保存在集群、数据库、文件中**

**Cookie是客户端保存用户信息的一种机制，用来记录用户的一些信息，也是实现Session的一种方式。**

### 本质:

**服务端是根据 Cookie 中的信息判断用户是否登录**.

### **区别：**

**Cookie 只能保存 ASCII，Session 可以存任意数据类型，一般情况下我们可以在 Session 中保持一些常用变量信息，比如说 UserId 等**

**有效期不同，Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭或者 Session 超时都会失效。**

**存储大小不同， 单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie。**

****



## **什么是Cookie?**

> **Cookie 是由浏览器维持的，存储在客户端的一小段文本信息.伴随着用户请求和页面在 Web 服务器和浏览器之间传递。用户每次访问站点时，Web 应用程序都可以读取 cookie 包含的信息。**

- cookie 是有时间限制的，根据生命期不同分成两种：会话 cookie 和持久 cookie；

  如果不设置过期时间，则表示这个 cookie 的生命周期为从创建到浏览器关闭为止，只要关闭浏览器窗口，cookie 就消失了。这种生命期为浏览会话期的 cookie 被称为会话 cookie。会话 cookie 一般不保存在硬盘上而是保存在内存里。

**如果浏览器中禁止了 Cookie，如何保障整个机制的正常运转？**

- **第一种方案，每次请求中都携带一个 `SessionID` 的参数，也可以 Post 的方式提交，也可以在请求的地址后面拼接 `xxx?SessionID=123456...`**

- **Token 机制。Token 机制多用于 App 客户端和服务器交互的模式，也可以用于 Web 端做用户状态管理。**

  Token 的意思是“令牌”，是服务端生成的一串字符串，作为客户端进行请求的一个标识。Token 机制和 Cookie 和 Session 的使用机制比较类似。

  **当用户第一次登录后，服务器根据提交的用户信息生成一个 Token，响应时将 Token 返回给客户端，以后客户端只需带上这个 Token 前来请求数据即可，无需再次登录验证。**



## 什么是token?

> `Session`是将要验证的信息存储在服务端，并以`SessionId`和数据进行对应，`SessionId`由客户端存储，在请求时将`SessionId`也带过去，因此实现了状态的对应。而`Token`是在服务端将用户信息经过Base64Url编码过后传给在客户端，每次用户请求的时候都会带上这一段信息，因此服务端拿到此信息进行解密后就知道此用户是谁了，这个方法叫做JWT(Json Web Token)。

**使用Token的目的：Token的目的是为了减轻服务器的压力，减少频繁的查询数据库，使服务器更加健壮。**了解了Token的意义后，我们就更明确的知道为什么要用他了。

### JWT的结构

实际的JWT大概长下面的这样，它是一个很长的字符串，中间用`.`分割成三部分

<img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/2/16ec5a45f8068493~tplv-t2oaga2asx-watermark.awebp" alt="img" style="zoom:200%;" />

## 总结

相信大家看到这应该对`Cookie`、`Session`、`Token`有一定的了解了，接下来再回顾一下重要的知识点

- Cookie是存储在客户端的
- Session是存储在服务端的，可以理解为一个状态列表。拥有一个唯一会话标识`SessionId`。可以根据`SessionId`在服务端查询到存储的信息。
- Token类似一个令牌，无状态的，服务端所需的信息被Base64编码后放到Token中，服务器可以直接解码出其中的数据。

