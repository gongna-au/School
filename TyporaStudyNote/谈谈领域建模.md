# 谈谈领域建模

> ​		领域建模的目标，是解决复杂业务中软件开发的一系列问题。领域建模也是实现这个目标的一条路径，一种方法论。在实践的过程中可能有一种似曾相识的感觉：虽然没听过这个概念，但是这种做法很有道理而且有可能我们本身就在做。
>   需要注意的是，领域建模的方法有多种，甚至关于领域模型本身的定义也有一些模糊之处。不同的方法论和流派思路大体相似，在细节上还有一些区别。不过条条大路通罗马，他们没有对错之分。
>   本文更多表现的是我对领域建模的理解，也希望对各位有所启发。

## 什么是领域模型

## 1.定义

领域模型，在本文中的定义源于《UML和模式应用》[1]，这本书对领域建模的概述是最完整、可操作性最强的。

> 领域模型(domain model)是对领域内的概念类或现实世界中对象的可视化表示。领域模型也成为概念模型、领域对象模型和分析对象模型。

领域模型是一种概念模型，也叫问题域模型。它表述的是某个领域的现实概念。
![img](http://fyl-image.oss-cn-hangzhou.aliyuncs.com/18-2-25/15598958.jpg)

## 2.与其他作者的定义的异同

本文提到的领域模型，基于C Larman在书中的定义。同时与其他作者定义的模型区别如下：

| 作者                      | 定义                                                         | 出处                                                         | 异同                                                         |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Martin Fowler             | Conceptual model                                             | Analysis Patterns: Reusable Object Models [3]                | 相同                                                         |
| Martin Fowler             | [Domain Model](https://martinfowler.com/eaaCatalog/domainModel.html) | Patterns of Enterprise Application Architecture [4]          | 不同。这里的领域模型指的是solution space的领域层的模型对象，也就是本文指的**系统模型**。其定义需要包括行为和数据的对象模型，即充血模型。 |
| Eric Evans                | Model                                                        | Domain-Driven Design –Tackling Complexity in the Heart of Software [5] | 不完全相同。这本经典的DDD理论，不再将分析模型和程序设计分离开，而是寻求一种能满足这两方面的单一模型。因此DDD的模型**既是领域模型，又是系统模型**。同时，通用语言也可以算作领域模型的一部分。 |
| George Fairbanks          | Domain Model                                                 | Just Enough Software Architecture [6]                        | 相同                                                         |
| *Object Management Group* | Computation Independent Model (CIM)                          | OMG. MDA Guide Version 1.0.1                                 | 相同                                                         |
| Grady Booch               | Object-oriented analysis                                     | Object-oriented Analysis and Design with Applications, 3rd edition [7] | 相同。面向对象分析的产出物就是问题域模型。                   |

其实可以看到，自从面向对象出现以来，出现了很多模型的分析和设计的方法（包括一些需求分析的方法）。其中有一点是共通的：程序设计要从问题域出发，用问题域分析出的模型来指导程序设计

# 为什么要做领域建模

  首先，建模的重要性在所有工程实践中都已经得到了广泛的认同。建模是一种抽象和分解的方法，它可以将复杂的问题拆解成一个个抽象，代表了特定的一块密集而内聚的信息。[7]
  上世纪80年代开始，人们对于面向对象建模产生了许多思考和方法，其中最流行的就是面向对象分析与设计[8]。

> 面向对象分析，强调的是在问题域发现并描述概念，解决的问题是**做正确的事情**。面向对象设计，强调的是定义软件对象，解决的问题是**正确的做事情**。

领域模型就是面向对象分析的主要产物，它表达了对现实问题的描述和抽象。

![img](http://fyl-image.oss-cn-hangzhou.aliyuncs.com/18-4-7/38403205.jpg)

不过我们为什么要按照这种流程来进行开发呢？理论上说，如果不做分析和设计，你也可以直接去做代码实现（甚至使用面向过程的编程语言），一样可以完成软件的功能需求。

- 如果不做设计直接实现，俗称走一步看一步。很大可能在开发过程中发现思维局限，开发进度推倒重来。
- 如果不做分析直接设计，看起来没什么问题。遗憾的是，通过这种方式构造的代码，并没有和现实世界连接起来，当我们的软件和需求稍加修改，这份代码就可能变得异常混乱和难以维护。而通过领域建模的，自上而下的设计，可以保证代码实现的层次结构和模块划分是科学的、稳定的。![img](http://fyl-image.oss-cn-hangzhou.aliyuncs.com/18-3-2/82987418.jpg)

- 举一个例子，在某电商系统的初期设计中，一个卖家账号只能开一个店铺，因此卖家和店铺的概念全部由卖家这一个模型来承载。所有店铺相关的模型（店铺红包、店铺评价等）全部与卖家模型做关联。这时，同一个模型拥有了两层业务含义，职责不明确。

> ​		领域建模可以降低软件和现实世界之间的差异，用真实的业务概念划分职责，目的是实现一个可以高效低成本维护的可持续发展的软件系统。
>   **从领域模型推导到系统实现是一套引导思考的方式，也是一套科学的开发流程。其核心目的在于提供了系统设计的“指导方针”。领域模型必须站在用户需求和业务发展的角度上，既可以用来同客户沟通验证需求，又可以避免模型因实现的考量而带偏（实现成本、遗留系统）。**

