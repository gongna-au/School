# Linux私房菜—**vim 程序编辑器**

### 9.1 vi 与与 vim

在 Linux 的系统中使用文字编辑器来编辑你的 Linux 参数配置文件,可是一件很重要的事情。

> 这里要再次的强调,不同的 Linux distribution 各有其不同的附加软件,例如 Red Hat Enterprise Linux 与 Fedora 的ntsysv 与setup 等,而 SuSE 则有 YAST 管理工具等等, 因此,如果你只会使用此种类型的软件来控制你的 Linux 系统时,当接管不同的 Linux distributions时,呵呵!那可就苦恼了

> Tips
> 什么是纯文本文件?其实文件记录的就是 0 与 1 ,而我们通过编码系统来将这些 0 与 1 转成我们认识的文字就是了。 在第零章里面的数据表示方式有较多说明,请自行查阅。 ASCII 就是其中一种广为使用的文字编码系统,在 ASCII 系统中的图示与代码可以参考http://zh.wikipedia.org/wiki/ASCII呢!

那么 Linux 在文本界面下的文书编辑器有哪些呢?其实有非常多喔!常常听到的就有: emacs, pico, nano, joe, 与 vim

#### 9.1.1 为何要学 vim

- 所有的 Unix Like 系统都会内置 vi 文书编辑器,其他的文书编辑器则不一定会存在;
- 很多个别软件的编辑接口都会主动调用 vi (例如未来会谈到的 crontab, visudo, edquota 等指令
- im 具有程序编辑的能力,可以主动的以字体颜色辨别语法的正确性,方便程序设计;
- 因为程序简单,编辑速度相当快速。

那么什么是 vim 呢?其实你可以将 vim 视作 vi 的进阶版本, vim 可以用颜色或底线等方式来显示一些特殊的信息。 举例来说,当你使用vim 去编辑一个 C 程序语言的文件,或者是我们后续会谈到的 shell script 脚本程序时, vim 会依据文件的扩展名或者是文件内的开头信息, 判断该文件的内容而自动的调用该程序的语法判断式,再以颜色来显示程序码与一般信息。也就是说, 这个 vim 是个 “ 程序编辑器 ” 啦!甚至一些Linux 基础配置文件内的语法,都能够用 vim 来检查呢! 例如我们在第七章谈到的 /etc/fstab 这个文件的内容。

**vim 里面加入了很多额外的功能,例如支持正则表达式的搜寻架构、多文件编辑、区块复制。**

#### 9.2 vi 的使用

基本上 vi 共分为三种模式,分别是 “ 一般指令模式 ” 、 “ 编辑模式 ” 与 “ 指令列命令模式 ” 。 这三种模式的作用分别是:

- 一般指令模式 ( command mode )
  以 vi 打开一个文件就直接进入一般指令模式了(这是默认的模式,也简称为一般模式)。在这个模式中, 你可以使用 “ 上下左
  右 ” 按键来移动光标,你可以使用 “ 删除字符 ” 或 “ 删除整列 ” 来处理文件内容, 也可以使用 “ 复制、贴上 ” 来处理你的文件数据。

- 编辑模式 ( insert mode )

  在一般指令模式中可以进行删除、复制、贴上等等的动作,但是却无法编辑文件内容的! 要等到你按下 “i, I, o, O, a, A, r, R” 等任何一个字母之后才会进入编辑模式。注意了!通常在 Linux 中,按下这些按键时,在画面的左下方会出现 “ INSERT 或 REPLACE ” 的字样,此时才可以进行编辑。而如果要回到一般指令模式时, 则必须要按下 “ Esc ” 这个按键即可退出编辑模式。

- 指令列命令模式 ( command-line mode )

  在一般模式当中,输入 “ : / ? ” 三个中的任何一个按钮,就可以将光标移动到最下面那一列。在这个模式当中, 可以提供你 “ 搜寻数据 ” 的动作,而读取、存盘、大量取代字符、离开 vi 、显示行号等等的动作则是在此模式中达成的

**一般指令模式可与编辑模式及指令列模式切换, 但编辑模式与指令列模式之间不可互相切换**

#### 9.2.1 简易执行范例

1. 使用 “ vi filename ” 进入一般指令模式

   直接输入 “ vi 文件名 ” 就能够进入 vi 的一般指令模式了。不过请注意,由于一般帐号默认已经使用 vim 来取代,因此如上表所示,如果使用一般帐号来测试,得要使用绝对路径的方式来执行 /bin/vi 才好!另外,请注意,记得 vi 后面一定要加文件名,不管该文件名存在与否

2. 整个画面主要分为两部份,上半部与最下面一列两者可以视为独立的。如下图 9.2.2 所示,图中那个虚线是不存在的, 鸟哥用来说明而已啦!上半部显示的是文件的实际内容,最下面一列则是状态显示列(如下图的 [New File] 信息),或者是命令下达列!

3. 如果你打开的文件是旧文件(已经存在的文件),则可能会出现如下的信息。箭头所指的那个 “"/etc/man_db.conf" [readonly] 131L, 5171C” 代表的是 “ 现在打开的文件名为
   /etc/man_db.conf , 由于启动者的身份缘故,目前文件为只读状态,且文件内有 131 列 以及具有 5171 个字符 ” 的意思!那一列的内容并不是在文件内,而是 vi 显示一些信息的地方喔!此时是在一般指令模式的环境下啦。接下来开始来输入

   

4. 

1. 按下 i 进入编辑模式,开始编辑文字

2. 在一般指令模式之中,只要按下 i, o, a 等字符就可以进入编辑模式了!在编辑模式当中,你可以发现在左下角状态列中会出现 –INSERT- 的字样,那就是可以输入任意字符的提示啰!这个时候,键盘上除了 [Esc] 这个按键之外,其他的按键都可以视作为一般的输入按钮了,所以你可以进行任何的编辑。

3. 按下 [ESC] 按钮回到一般指令模式

   马上你就会发现画面左下角的 – INSERT – 不见了!!

4. 进入指令列模式,文件储存并离开 vi 环境。

   OK ,我们要存盘了,存盘 ( write ) 并离开 ( quit ) 的指令很简单,输入 “:wq” 即可存盘离开! (注意了,按下 : 该光标就会移动
   到最下面一列去!) 这时你在提示字符后面输入 “ ls -l ” 即可看到我们刚刚创建的 welcome.txt 文件

5. 如此一来,你的文件 welcome.txt 就已经创建起来啰!需要注意的是,如果你的文件权限不对,例如为 -r--r--r-- 时,那么可能会无法写入,此时可以使用 “ 强制写入 ” 的方式吗?可以!使用 “ :wq! ” 多加一个惊叹号即可!不过,需要特别注意呦!那个是在 “ 你的权限可以改变 ” 的情况下才能成立的!

#### 9.2.2 按键说明

> 第一部份:
>
> 一般指令模式可用的按钮说明,光标移动、复制贴上、搜寻取代等



| [Ctrl] + [f]     | 屏幕“向下”移动一页,相当于 [Page Down]按键 (常用 |
| ---------------- | ----------------------------------------------- |
| [Ctrl] + [b]     | 屏幕“向上”移动一页,相当于 [Page Up] 按键 (常用) |
| [Ctrl] + [d]     | 屏幕“向下”移动半页                              |
| [Ctrl] + [u]     | 屏幕“向上”移动半页                              |
| +                | 光标移动到非空白字符的下一列                    |
| —                | 标移动到非空白字符的上一列                      |
| 0 或功能键[Home] | 这是数字“ 0 ”:移动到这一列的最前面字符处 (常用  |

搜索与取代

| /word                 | 向光标之下寻找一个名称为 word 的字串。例如要在文件内搜寻 vbird 这个字串,就输入 /vbird 即可!<br/>(常用) |
| --------------------- | ------------------------------------------------------------ |
| ?word                 | 向光标之上寻找一个字串名称为 word 的字串                     |
| n                     | n 这个 n 是英文按键。代表“重复前一个搜寻的动作”。举例来说, 如果刚刚我们执行 /vbird 去向下搜寻<br/>vbird 这个字串,则按下 n 后,会向下继续搜寻下一个名称为 vbird 的字串。如果是执行 ?vbird 的话,<br/>那么按下 n 则会向上继续搜寻名称为 vbird 的字串! |
| :n1,n2s/word1/word2/g | n1 与 n2 为数字。在第 n1 与 n2 列之间寻找 word1 这个字串,并将该字串取代为 word2 !举例来说,在<br/>100 到 200 列之间搜寻 vbird 并取代为 VBIRD 则:<br/>“:100,200s/vbird/VBIRD/g”。(常用 |
| :1,$s/word1/word2/g   | 从第一列到最后一列寻找 word1 字串,并将该字串取代为 word2 !(常用 |
| :1,$s/word1/word2/gc  | 从第一列到最后一列寻找 word1 字串,并将该字串取代为 word2 !且在取代前显示提示字符给使用者确认<br/>(confirm) 是否需要取代!(常用 |
|                       |                                                              |

删除复制与贴上

| x, X     | 在一列字当中,x 为向后删除一个字符<br/>[backspace] 亦即是倒退键) (常用) |
| -------- | ------------------------------------------------------------ |
| dd       | 删除光标所在的那一整列(常用                                  |
| yy       | 复制光标所在的那一列(常用)                                   |
| u        | 复原前一个动作                                               |
| [Ctrl]+r | 重做上一个动作。(常用                                        |
| .        | 不要怀疑!这就是小数点!意思是重复前一个动作的意思。 如果你想要重复删除、重复贴上等等动作,按下<br/>小数点“.”就好了! (常用) |
|          |                                                              |

> 第二部份:一般指令模式切换到编辑模式的可用的按钮说明

| 进入插入或者取代的编辑模式 |                                                              |
| -------------------------- | ------------------------------------------------------------ |
| i   I                      | 进入插入模式(Insert mode):<br/>i 为“从目前光标所在处插入”, I 为“在目前所在列的第一个非空白字符处开始插入 |
| a, A                       | 进入插入模式(Insert mode):<br/>a 为“从目前光标所在的下一个字符处开始插入”, A 为“从光标所在列的最后一个字符处开始插入 |
| o, O                       | 进入插入模式(Insert mode):<br/>这是英文字母 o 的大小写。o 为“在目前光标所在的下一列处插入新的一列”; O 为在目前光标所在处的上一列插<br/>入新的一列!(常用) |
| r, R                       | 进入取代模式(Replace mode):<br/>r 只会取代光标所在的那一个字符一次;R会一直取代光标所在的文字,直到按下 ESC 为止;(常用) |
|                            | 上面这些按键中,在 vi 画面的左下角处会出现“--INSERT--”或“--REPLACE--”的字样。 由名称就知道该动作了吧!!特别注意的<br/>是,我们上面也提过了,你想要在文件里面输入字符时, 一定要在左下角处看到 INSERT 或 REPLACE 才能输入 |

**[Esc]**退出编辑模式,回到一般指令模式中(常用

> 第三部份:一般指令模式切换到指令列模式的可用按钮说明

|            | 指令列模式的储存、离开等指令                                 |
| ---------- | ------------------------------------------------------------ |
| ：w        | 把编辑的数据写入硬盘                                         |
| ：w!       | 若文件的属性为只读，强制写入该文件，最后能不能写入取决于你文件的权限 |
| ：q        | 离开vi                                                       |
| :q！       | 修改过文件，但是不想保存就使用！强制离开。                   |
| :wq   :wq! | 储存后离开,若为 :wq! 则为强制储存后离开 (常用                |
| :! command | 暂时离开 vi 到指令列模式下执行 command 的显示结果!例如<br/>“:! ls /home”即可在 vi 当中察看 /home 下面以 ls 输出的文件信息 |

#### 9.2.4 vim 的暂存盘、救援回复与打开时的警告讯息

在目前主要的文书编辑软件都会有 “ 回复 ” 的功能,亦即当你的系统因为某些原因而导致类似死机的情况时, 还可以通过某些特别的机制来让你将之前未储存的数据 “ 救 ” 回来!这就是鸟哥这里所谓的 “ 回复 ” 功能啦! 那么 vim 有没有回复功能呢?有的! vim 就是通过 “ 暂存盘 ” 来救援.当我们在使用 vim 编辑时, vim 会在与被编辑的文件的目录下,再创建一个名为 .filename.swp 的文件。 比如说我们在上一个小节谈到的编辑 /tmp/vitest/man_db.conf 这个文件时, vim 会主动的创建 /tmp/vitest/.man_db.conf.swp 的暂存盘,你对 man_db.conf 做的动作就会被记录到这个.man_db.conf.swp 当中.如果你的系统因为某些原因断线了, 导致你编辑的文件还没有储存,这个时候 .man_db.conf.swp 就能够
发挥救援的功能.

```
[dmtsai@study ~]$ cd /tmp/vitest
[dmtsai@study vitest]$ vim man_db.conf
# 此时会进入到 vim 的画面,请在 vim 的一般指令模式下按下“ [ctrl]-z ”的组合键
[1]+ Stopped
vim man_db.conf <==按下 [ctrl]-z 会告诉你这个讯息
```

当我们在 vim 的一般指令模式下按下 [ctrl]-z 的组合按键时,你的 vim 会被丢到背景去执行! 这部份的功能我们会在第十六章的程序管理当中谈到, 你这里先知道一下即可。回到命令提示字符后,接下来我们来仿真将 vim 的工作不正常的中断吧!

**那个 kill 可以仿真将系统的 vim 工作删除的情况,你可以假装死机了啦! 由于 vim 的工作被不正常的中断,导致暂存盘无法借由正常流程来结束, 所以暂存盘就不会消失,而继续保留下来**此时如果你继续编辑那个 man_db.conf ,会出现什么情况呢? 会出现如下所示的状态

```
[dmtsai@study vitest]$ vim man_db.conf
E325: ATTENTION <==错误代码
Found a swap file by the name " .man_db.conf.swp " <==下面数列说明有暂存盘的存在
owned by: dmtsai dated: Mon Jul 6 23:54:16 2015
file name: /tmp/vitest/man_db.conf <==这个暂存盘属于哪个实际的文件?
modified: no
user name: dmtsai host name: study.centos.vbird
process ID: 31851
While opening file "man_db.conf"
dated: Mon Jul 6 23:47:21 2015
下面说明可能发生这个错误的两个主要原因与解决方案!
( 1 )
Another program may be editing the same file. If this is the case,
be careful not to end up with two different instances of the same
file when making changes. Quit, or continue with caution.
( 2 ) An edit session for this file crashed.
If this is the case, use ":recover" or "vim -r man_db.conf"
to recover the changes ( see ":help recovery" ) .
If you did this already, delete the swap file ".man_db.conf.swp"
to avoid this message.
Swap file ".man_db.conf.swp" already exists! 下面说明你可进行的动作
[O]pen Read-Only, ( E ) dit anyway, ( R ) ecover, ( D ) elete it, ( Q ) uit, ( A ) bort:
```

由于暂存盘存在的关系,因此 vim 会主动的判断你的这个文件可能有些问题,在上面的图示中 vim 提示两点主要的问题与解决方案,分别是这样的:

- 问题一:可能有其他人或程序同时在编辑这个文件:由于 Linux 是多用户多任务的环境,因此很可能有很多人同时在编辑同一个文件。如果在多人共同编辑的情况下, 万一大家同时储存,那么这个文件的内容将会变的乱七八糟!为了避免这个问题,因此 vim 会出现这个警告窗口! 解决的方法则是
  - 找到另外那个程序或人员,请他将该 vim 的工作结束,然后你再继续处理。
  - 如果你只是要看该文件的内容并不会有任何修改编辑的行为,那么可以选择打开成为只读( O )文件, 亦即上述画面反白部分输入英文 “ o ” 即可,其实就是 [O]pen Read-Only 的选项啦!

- 问题二:在前一个 vim 的环境中,可能因为某些不知名原因导致 vim 中断 ( crashed ):这就是常见的不正常结束 vim 产生的后果。解决方案依据不同的情况而不同喔!常见的处理方法为:
  - 如果你之前的 vim 处理动作尚未储存,此时你应该要按下 “R” ,亦即使用 ( R ) ecover 的项目, 此时 vim 会载入 .man_db.conf.swp的内容,让你自己来决定要不要储存!这样就能够救回来你之前未储存的工作。 不过那个 .man_db.conf.swp 并不会在你结束 vim后自动删除,所以你离开 vim 后还得要自行删除 .man_db.conf.swp 才能避免每次打开这个文件都会出现这样的警告!
  - 如果你确定这个暂存盘是没有用的,那么你可以直接按下 “D” 删除掉这个暂存盘,亦即 ( D ) elete it 这个项目即可。 此时 vim 会载入 man_db.conf ,并且将旧的 .man_db.conf.swp 删除后,创建这次会使用的新的 .man_db.conf.swp 喔!

- [O]pen Read-Only :打开此文件成为只读文件
- ( E ) dit anyway :还是用正常的方式打开你要编辑的那个文件
- (R ) ecover :就是载入暂存盘的内容,用在你要救回之前未储存的工作。 不过当你救回来并且储存离开 vim 后,还是要手动自行删除那个暂存盘喔!
- ( D ) elete it :你确定那个暂存盘是无用的!那么打开文件前会先将这个暂存盘删除!
- ( Q ) uit :按下 q 就离开 vim ,不会进行任何动作回到命令提示字符。
- ( A ) bort :忽略这个编辑行为,感觉上与 quit 非常类似! 也会送你回到命令提示字符

### 9.3 vim 的额外功能

vim 具有颜色显示的功能,并且还支持许多的程序语法 ( syntax ), 因此,当你使用 vim 编辑程序时 (不论是 C 语言,还是 shell script ),我们的 vim 将可帮你直接进行 “ **程序除错**

假设我想要编辑 /etc/services ,则输入 “vim/etc/services” 看看吧

1. 由于 /etc/services 是系统规划的配置文件,因此 vim 会进行语法检验,所以你会看到画面中内部主要为深蓝色, 且深蓝色那一列是以注解符号 ( # ) 为开头;
2. 画面中的最下面一列,在左边显示该文件的属性,包括只读文件、内容共有 11176 列与 670293 个字符;
3. 最下面一列的右边出现的 1,1 表示光标所在为第一列 , 第一个字符位置之意(请看上图中的光标所在);

#### 9.3.1 区块选择( Visual Block )

这个文件我将他放置到 http://linux.vbird.org/linux_basic/0310vi/hosts ,你可以自行下载来看一看这个文件啊!现在我们来玩一玩这个文件吧!假设我想要将 host1, host2... 等等复制起来, 并且加到每一列的后面,亦即每一列的结果要是 “ 192.168.1.2 host2.class.net host2 ” 这样的情况时, 在传统或现代的窗口型编辑器似乎不容易达到这个需求,但是咱们的 vim 是办的到的喔!那就使用区块选择 ( Visual Block ) 吧!当我们按下 v 或者 V 或者 [Ctrl]+v 时, 这个时候光标移动过的地方就会开始反白,这三个按键的意义分别是:

|          | 区块选择的按键的意义                |
| -------- | ----------------------------------- |
| v        | 字符选择,会将光标经过的地方反白选择 |
| V        | 列选择,会将光标经过的列反白选择     |
| [Ctrl]+v | 区块选择,可以用长方形的方式选择数据 |
| y        | 将反白的地方复制起来                |
| d        | 将反白的地方删除掉                  |
| p        | 将刚刚复制的区块,在光标所在处贴上!  |

1. 将光标移动到第一列的 host 那个 h 上头,然后按下 [ctrl]-v ,左下角出现区块示意字样:
2. 将光标移动到最底部,此时光标移动过的区域会反白!如下图所示
3. 此时你可以按下 “ y ” 来进行复制,当你按下 y 之后,反白的区块就会消失不见

#### 9.3.2 多文件编辑

|        | 多文件编辑的按键                  |
| ------ | --------------------------------- |
| :n     | 编辑下一个文件                    |
| :N     | 编辑上一个文件                    |
| :files | 列出目前这个 vim 的打开的所有文件 |

1. 通过 “ vim hosts /etc/hosts ” 指令来使用一个 vim 打开两个文件;
2. 在 vim 中先使用 “ :files ” 察看一下编辑的文件数据有啥
3. 在第一列输入 “ 4yy ” 复制四列
4. 在 vim 的环境下输入 “ :n ” 会来到第二个编辑的文件,亦即 /etc/hosts 内
5. 在 /etc/hosts 下按 “ G ” 到最后一列,再输入 “ p ” 贴上;
6. 按下多次的 “ u ” 来还原原本的文件数据;
7. 最终按下 “ :q ” 来离开 vim 的多文件编辑吧!

#### 9.3.3 多窗口功能

利用多文件编辑的功能,可以让你很快速的就将需要的数据复制到正确的文件内。 当然啰,这个功能也可以利用窗口接口来
达到,那就是下面要提到的多窗口功能

- 当我有一个文件非常的大,我查阅到后面的数据时,想要 “ 对照 ” 前面的数据, 是否需要使用 [ctrl]+f 与 [ctrl]+b (或 pageup, pagedown 功能键) 来跑前跑后查阅?
- **我有两个需要对照着看的文件,不想使用前一小节提到的多文件编辑功能**

在一般窗口接口下的编辑软件大多有 “ 分区窗口 ” 或者是 “ 冻结窗口 ” 的功能来将一个文件分区成多个窗口的展现, 那么 vim 能不能达到这个功能啊?可以啊!但是如何分区窗口并放入文件呢? 很简单啊!在指令列模式输入 `“:sp {filename}”`  **如果想要
在新窗口启动另一个文件,就加入文件名,否则仅输入 :sp 时, 出现的则是同一个文件在两个窗口间!**

|                            | 多窗口下的按键功能                                           |
| -------------------------- | ------------------------------------------------------------ |
| :sp [filename]             | 打开一个新窗口,如果有加filename, 表示在新窗口打开一个新文件,否则表示两个窗口为同一个文件内容(同步显示) |
| [ctrl]+w+ j<br/>[ctrl]+w+↓ | 按键的按法是:先按下 [ctrl] 不放, 再按下 w 后放开所有的按键,然后再按下 j (或向下方向键),则光标<br/>可移动到下方的窗口。 |
| [ctrl]+w+ k<br/>[ctrl]+w+↑ | 同上,不过光标移动到上面的窗口。                              |
| [ctrl]+w+ q                | 其实就是 :q 结束离开啦! 举例来说,如果我想要结束下方的窗口,那么利用 [ctrl]+w+↓ 移动到下方窗口<br/>后,按下 :q 即可离开, 也可以按下 [ctrl]+w+q 啊! |

#### 9.3.4 vim 的挑字补全功能

我们知道 bash 的环境下面可以按下 [tab] 按钮来达成指令 / 参数 / 文件名的补全功能,而我们也知道很多的程序编辑器,例如鸟哥用来在
windows 系统上面教网页设计、 java script 等很好用的 notepad++ ( https://notepad-plus-plus.org/ ) 这种类的程序编辑器,都会有 ( 1 )可以进行语法检验及 ( 2 )可以根据扩展名来挑字的功能!这两个功能对于程序设计者来说, 是很有帮助的!毕竟偶尔某些特定的关键字老是背不起来 ...
在语法检验方面, vim 已经使用颜色来达成了!这部份不用伤脑筋的!比较伤脑筋的应该是在挑字补全上面!就是上面谈到的可以根据
语法来挑选可能的关键字, 包括程序语言的语法以及特定的语法关键字等等。既然 notepad ++ 都有支持了,没道理 vim 不支持吧?呵呵!没错! 是有支持的~只是你可能要多背两个组合按钮就是了!

**建议可以记忆的主要 vim 补齐功能,大致有下面几个:**

| 组合按钮             | 补齐的内容                                                   |
| -------------------- | ------------------------------------------------------------ |
| [ctrl]+x -> [ctrl]+n | 通过目前正在编辑的这个 “ 文件的内容文字 ” 作为关键字,予以补齐 |
| [ctrl]+x -> [ctrl]+f | 以当前目录内的 “ 文件名 ” 作为关键字,予以补齐                |
| [ctrl]+x -> [ctrl]+o | 以扩展名作为语法补充,以 vim 内置的关键字,予以补齐            |

**比较有用的是第 1, 3 这两个组合键,第一个组合按键中,你可能会在同一个文件里面重复出现许多相同的关键字, 那么就能够通过这个补全的功能来处理。如果你是想要使用 vim 内置的语法检验功能来处理取得关键字的补全,那么第三个项目就很有用了**

假设你想要编写网页,正要使用到 CSS 的美化功能时,突然想到有个背景的东西要处理,但是突然忘记掉背景的 CSS 关键语法,那可
以使用如下的模样来处置! 请注意,一定要使用 .html 或 .php 的扩展名,否则 vim 不会调用正确的语法检验功能喔!因此下面我们创建的文件名为 html.html !

由于网页通常会支持 CSS 的语法,而 CSS 的美化语法使用的是 style 这个关键字,这个关键字后面接的就是 CSS 的元素与元素值。
若想要取得可能的元素有哪些,例如背景 ( background ) 的语法中,想要了解有哪些跟它有关的内置元素,如上图, 直接输入 b 然后按下[crtl]+x 再按下 [crtl]+o 就会出现如上的相关字词可以选择,此时你就能够使用上下按钮来挑选所需要的关键元素! 这样使用上当然方便很多只是要注意,一定要使用正确的扩展名,否则会无法出现任何关键字词!

#### 9.3.5 vim 环境设置与记录: ~/.vimrc, ~/.viminfo

有没有发现,如果我们以 vim 软件来搜寻一个文件内部的某个字串时,这个字串会被反白, 而下次我们再次以 vim 编辑这个文件时,该
搜寻的字串反白情况还是存在呢!甚至于在编辑其他文件时, 如果其他文件内也存在这个字串,哇!竟然还是主动反白耶!真神奇! 另外,当我们重复编辑同一个文件时,当第二次进入该文件时, 光标竟然就在上次离开的那一列上头呢!真是好方便啊~但是,怎么会这样呢?
这是因为我们的 vim 会主动的将你曾经做过的行为登录下来,好让你下次可以轻松的作业啊! 那个记录动作的文件就是: ~/.viminfo !
如果你曾经使用过 vim , 那你的主文件夹应该会存在这个文件才对。这个文件是自动产生的, 你不必自行创建。而你在 vim 里头所做过的动作,就可以在这个文件内部查询到啰~ ^

此外,每个 distributions 对 vim 的默认环境都不太相同,举例来说,某些版本在搜寻到关键字时并不会高亮度反白, 有些版本则会主动
的帮你进行缩排的行为。但这些其实都可以自行设置的,那就是 vim 的环境设置啰~ vim 的环境设置参数有很多,如果你想要知道目前的设置值,可以在一般指令模式时输入 “ :set all ” 来查阅

> 所谓的缩排,就是当你按下 Enter 编辑新的一列时,光标不会在行首,而是在与上一列的第一个非空白字符处对齐

|                                       | vim 的环境设置参数                                           |
| ------------------------------------- | ------------------------------------------------------------ |
| :set nu<br/>:set nonu                 | 就是设置与取消行号啊                                         |
| :set hlsearch<br/>:set nohlsearch     | hlsearch 就是 high light search(高亮度搜寻)。 这个就是设置是否将搜寻的字串反白的设置值。默认值<br/>是 hlsearch |
| :set autoindent<br/>:set noautoindent | 是否自动缩排?autoindent 就是自动缩排                         |
| :set backup                           | 是否自动储存备份文件?一般是 nobackup 的, 如果设置 backup 的话,那么当你更动任何一个文件时,则<br/>原始文件会被另存成一个文件名为 filename~ 的文件。 举例来说,我们编辑 hosts ,设置 :set backup ,<br/>那么当更动 hosts 时,在同目录下,就会产生 hosts~ 文件名的文件,记录原始的 hosts 文件内容 |
| :set ruler                            | 还记得我们提到的右下角的一些状态列说明吗? 这个 ruler 就是在显示或不显示该设置值的啦 |
| :set showmode                         | 这个则是,是否要显示 --INSERT-- 之类的字眼在左下角的状态列    |
| :set<br/>backspace=(012               | 一般来说, 如果我们按下 i 进入编辑模式后,可以利用倒退键 (backspace) 来删除任意字符的。 但是,<br/>某些 distribution 则不许如此。此时,我们就可以通过 backspace 来设置啰~ 当 backspace 为 2 时,就<br/>是可以删除任意值;0 或 1 时,仅可删除刚刚输入的字符, 而无法删除原本就已经存在的文字了 |
| :set all                              | 显示目前所有的环境参数设置值。                               |
| :set                                  | 显示与系统默认值不同的设置参数, 一般来说就是你有自行变动过的设置参数啦 |

| :syntax on<br/>:syntax off     | 是否依据程序相关语法显示不同颜色? 举例来说,在编辑一个纯文本文件时,如果开头是以 # 开始,那么该<br/>列就会变成蓝色。 如果你懂得写程序,那么这个 :syntax on 还会主动的帮你除错呢!但是, 如果你仅是编<br/>写纯文本,要避免颜色对你的屏幕产生的干扰,则可以取消这个设置 |
| ------------------------------ | ------------------------------------------------------------ |
| :set bg=dark<br/>:set bg=light | 可用以显示不同的颜色色调,默认是“ light ”。如果你常常发现注解的字体深蓝色实在很不容易看, 那么<br/>这里可以设置为 dark 喔!试看看,会有不同的样式呢! |

我们可以通过配置文件来直接规定我们习惯的 vim 操作环境呢! 整体 vim 的设置值一般是放置在 /etc/vimrc 这个文件,不过,不建议你修改他! 你可以修改 ~/.vimrc 这个文件 (默认不存在,请你自行手动创建!),将你所希望的设置值写入! 举例来说,可以是这样的一个文件:

```
[dmtsai@study ~]$ vim ~/.vimrc
" 这个文件的双引号
set hlsearch  "高亮度反白
set backspace=2 "可随时用倒退键删除
set autoindent	"自动缩排
set ruler 		"可显示最后一列的状态
set showmode	"左下角那一列的状态
set nu 			"可以在每一列的最前面显示行号
set bg=dark		"显示不同的底色色调
syntax on		"进行语法检验,颜色显示

```

使用 “ set hlsearch ” 或 “ :set hlsearch ” ,亦即最前面有没有冒号 “ : ” 效果都是一样的! 至于双引号则是注解符号!不要用
错注解符号,否则每次使用 vim 时都会发生警告讯息喔! 创建好这个文件后,当你下次重新以 vim 编辑某个文件时,该文件的默认环境设置就是上头写的

### 9.4 其他 vim 使用注意事项

#### 9.4.1 中文编码的问题

如果你的文件是使用 big5 编码制作的,但在 vim 的终端接口中你使用的是万国码( utf8 ), 由于编码的不同,你的中文文件内容当然就是一堆乱码了!怎么办?这时你得要考虑许多东西啦!有这些:

1. 你的 Linux 系统默认支持的语系数据:这与 /etc/locale.conf 有关;
2. 你的终端接口 ( bash ) 的语系: 这与 LANG, LC_ALL 这几个变量有关;
3. 你的文件原本的编码

#### 9.4.2 DOS 与 Linux 的断行字符

DOS 使用的断行字符为 ^M$ ,我们称为 CR 与 LF 两个符号。 而在 Linux 下面,则是仅有 LF ( $ ) 这个断行符号。这个断行符号对于 Linux 的影响很大。

**在 Linux 下面的指令在开始执行时,他的判断依据是 “Enter” ,而 Linux 的 Enter 为 LF 符号**由于 DOS 的断行符号是CRLF ,也就是多了一个 ^M 的符号出来, 在这样的情况下,如果是一个 shell script 的程序文件。将可能造成 “ 程序无法执行 ” 的状态

那怎么办啊?很简单啊,将格式转换成为 Linux 即可啊! “ 废话 ” ,这当然大家都知道,但是, 要以 vi 进入该文件,然后一个一个删除每
一列的 CR 吗?当然没有这么没人性啦! 我们可以通过简单的指令来进行格式的转换啊

那就开始来玩一玩这个字符转换

```
[dmtsai@study ~]$ dos2unix [-kn] file [newfile]
[dmtsai@study ~]$ unix2dos [-kn] file [newfile]
选项与参数:
-k :保留该文件原本的 mtime 时间格式 (不更新文件上次内容经过修订的时间)
-n :保留原本的旧文件,将转换后的内容输出到新文件,如: dos2unix -n old new
/etc/man_db.conf 重新复制到 /tmp/vitest/ 下面,并将其修改成为 dos 断行
[dmtsai@study ~]# cd /tmp/vitest
[dmtsai@study vitest]$ cp -a /etc/man_db.conf .
[dmtsai@study vitest]$ ll man_db.conf
-rw-r--r--. 1 root root 5171 Jun 10 2014 man_db.conf
[dmtsai@study vitest]$ unix2dos -k man_db.conf
unix2dos: converting file man_db.conf to DOS format ...
范例一:将
# 屏幕会显示上述的讯息,说明断行转为 DOS 格式了!
[dmtsai@study vitest]$ ll man_db.conf
-rw-r--r--. 1 dmtsai dmtsai 5302 Jun 10 2014 man_db.conf
# 断行字符多了 ^M ,所以容量增加了!
man_db.conf 转成 Linux 断行字符,并保留旧文件,新文件放于 man_db.conf.linux
[dmtsai@study vitest]$ dos2unix -k -n man_db.conf man_db.conf.linux
dos2unix: converting file man_db.conf to file man_db.conf.linux in Unix format ...
[dmtsai@study vitest]$ ll man_db.conf*
-rw-r--r--. 1 dmtsai dmtsai 5302 Jun 10 2014 man_db.conf
-rw-r--r--. 1 dmtsai dmtsai 5171 Jun 10 2014 man_db.conf.linux
[dmtsai@study vitest]$ file man_db.conf*
man_db.conf:
ASCII text, with CRLF line terminators # 很清楚说明是 CRLF 断行!
man_db.conf.linux: ASCII text
```

因为断行字符以及 DOS 与 Linux 操作系统下面一些字符的定义不同,因此, 不建议你在 Windows 系统当中将文件编辑好之后,才上传到 Linux 系统,会容易发生错误问题。 而且,如果你在不同的系统之间复制一些纯文本时,千万记得要使用 unix2dos 或 dos2unix 来转换一下断行格式啊!

#### 9.4.3 语系编码转换

举例来说,想要将 big5 编码转成 utf8 。 这个时候怎么办?难不成要每个文件打开会转存成 utf8 吗?不需要这样做啦!使用 iconv 这个指令即可

在终端机的环境下你可以使用 “ wget 网址 ” 来下载http://linux.vbird.org/linux_basic/0310vi/vi.big5在 /tmp/vitest 目录下。 接下来让我们来使用 iconv 这个指令来玩一玩编码转换吧!

```
iconv --list
[dmtsai@study ~]$ iconv -f 原本编码 -t 新编码 filename [-o newfile]
选项与参数:
--list :列出 iconv 支持的语系数据
-f
:from ,亦即来源之意,后接原本的编码格式;
-t
:to ,亦即后来的新编码要是什么格式;
-o file:如果要保留原本的文件,那么使用 -o 新文件名,可以创建新编码文件
将/tmp/vitest/vi.big5 转成 utf8 编码吧!
[dmtsai@study ~]$ cd /tmp/vitest
[dmtsai@study vitest]$ iconv -f big5 -t utf8 vi.big5 -o vi.utf8
[dmtsai@study vitest]$ file vi*
vi.big5: ISO-8859 text, with CRLF line terminators
vi.utf8: UTF-8 Unicode text, with CRLF line terminators
```

### 9.5 重点回顾

- Linux 下面的配置文件多为文本文件,故使用 vim 即可进行设置编辑;
- vim 可视为程序编辑器,可用以编辑 shell script, 配置文件等,避免打错字
- vi 为所有 unix like 的操作系统都会存在的编辑器,且执行速度快速;
- vi 有三种模式,一般指令模式可变换到编辑与指令列模式,但编辑模式与指令列模式不能互换;
- 常用的按键有 i, [Esc], :wq 等;
- vi 的画面大略可分为两部份,( 1 )上半部的本文与( 2 )最后一行的状态 + 指令列模式;
- 光标的移动中,大写的 G 经常使用,尤其是 1G, G 移动到文章的头 / 尾功能!
- vi 的取代功能也很棒! :n1,n2s/old/new/g 要特别注意学习起来;
- 小数点 “ . ” 为重复进行前一次动作,也是经常使用的按键功能!
- 进入编辑模式几乎只要记住: i, o, R 三个按钮即可!尤其是新增一列的 o 与取代的 R
- vim 会主动的创建 swap 暂存盘,所以不要随意断线!
- 如果在文章内有对齐的区块,可以使用 [ctrl]-v 进行复制 / 贴上 / 删除的行为
- 使用 :sp 功能可以分区窗口
- 若使用 vim 来撰写网页,若需要 CSS 元素数据,可通过[crtl]+x, [crtl]+o 这两个连续组合按键来取得关键字
- vim 的环境设置可以写入在 ~/.vimrc 文件中
- 可以使用 iconv 进行文件语系编码的转换
- 使用 dos2unix 及 unix2dos 可以变更文件每一列的行尾断行字符



